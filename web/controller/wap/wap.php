<?phpnamespace wap;use Move\db;class wap extends \move\mvc\Controller{	public $theme = [];	public $config = [];	public $game = [];	public $daohang = [];	public $coin_list = [];	public $coin = [];	public $market_list = [];	public $market = [];	public $user = [];	public $userid = [];	public $user_coin = [];	public $pages = [];	public $hints = [];	public $xnb = [];	public $rmb = [];	public $token = [];	public function __construct()	{		$_GET["ajax"] = 1;		parent::__construct();		$mm = mm();		if (!isset($mm['game']) || !in_array("wap", explode("|", $mm["game"]))) {			redirect("/");		}		defined('MS_API') or define('MS_API', 0);		$this->assign('ms_api', MS_API);		$currentVersion = file_get_contents(APP_PATH . '/backup/version.ini');		$this->assign('version', $currentVersion);		defined('MS_TEMPLATE') or define('MS_TEMPLATE', 'default');		defined('APP_DEMO') or define('APP_DEMO', 0);		$config = md('sys_config')->lists();		$this->config = $config;		if ($this->config['web_close'] != 1) {			exit($this->config['web_close_cause']);		}		if (!$this->theme) {			$this->theme = cookie('theme');		}		if (!$this->theme) {			$this->theme = 'style';		}		if (!$this->config['mr_index']) {			$this->config['mr_index'] = 'a';		}		if (!$this->config['mr_kefu']) {			$this->config['mr_kefu'] = 'a';		}		$this->config['mr_kefu'] = 'kefu:' . $this->config['mr_kefu'] . '/index';		$this->assign('kefu', $this->config['mr_kefu']);		if (isset($this->config['wap_close']) && $this->config['wap_close'] == 1) {			$this->assign('ms_moble', 1);		} else {			header('Location:/');			$this->assign('ms_moble', 0);		}		$game_list = db::table("version_game")->where(["status" => 1, 'anzhuang' => 1, 'menu' => 1])->order("`sort` ASC")->select();		if ($game_list) {			foreach ($game_list as $k => $v) {				$game[$k] = $v;			}		} else {			$game = [];		}		$this->game = $game;		$daohang = mc("home_daohang");		if (!$daohang) {			$daohang = db::table('sys_daohang')->where(["status" => 1])->order("`sort` ASC ,id desc")->select();			mc("home_daohang", $daohang, 600);		}		$this->daohang = $daohang;		$lang_type_list = mc("home_lang_type");		if (!$lang_type_list) {			$lang_type = db::table("sys_lang_type")->where(["status" => 1])->order("`sort` ASC ,id desc")->select();			$lang_type_list = [];			if ($lang_type) {				foreach ($lang_type as $k => $v) {					$lang_type_list[$v['name']] = $v;				}			}			mc("home_lang_type", $lang_type_list);		}		$this->lang_type_list = $lang_type_list;		if (cookie('lang')) {			$this->lang_type_cn = isset($lang_type_list[cookie('lang')]) ? $lang_type_list[cookie('lang')] : [];		} else {			$this->lang_type_cn = isset($lang_type_list['cn']) ? $lang_type_list['cn'] : [];		}		$mymc_coin = new \mymc\coin();		$coin_list = $mymc_coin->select();		$this->coin_list = $coin_list;		if (!$this->coin) {			$this->coin = $this->config['mr_coin'];		}		$market_list = mc("home_market_list");		if (!$market_list) {			$market_list = md('trade')->market_list();			mc("home_market_list", $market_list, 60);		}		$this->market_list = $market_list;		if (!$this->market) {			$this->market = $this->config['mr_market'];		}		$this->userid = session('userid');		if ($this->userid) {			$this->user = db::table("user")->where(["id" => $this->userid])->find();			$this->user_coin = db::table("user_coin")->where(['userid' => $this->userid])->find();		}		if (empty($_POST)) {			if ($this->user) {				$this->user['username'] = substr_replace(str_replace("|", " ", $this->user['username']), '**', 3, 2);				$this->user['showid'] = $this->user['id'] + 10000;				if (!in_array(config("controller_name"), ['reg'])) {				}				if (isset($this->config['idcard_img']) && $this->config['idcard_img'] == 1 && isset($this->config['idcard_bx']) && $this->config['idcard_bx'] == 1) {					if (isset($this->user['idcard_rz']) && !$this->user['idcard_rz']) {						if (strtolower(config("action_name")) != 'truename') {							redirect('/user/truename');						} else {							if (strtolower(config("controller_name")) != 'user') {								redirect('/user/truename');							}						}					}				}			}			$footer_article = mc("home_footer_article");			if (!$footer_article) {				$footer_article = $this->get_footer_article();				mc("home_footer_article", $footer_article);			}			$this->footer_article = $footer_article;		}	}	public function get_footer_article()	{		$article_type_list = db::table('article_type')->field("id,title")->where(["status" => "1", 'type' => 2])->limit(3)->order("`sort` ASC")->select();		foreach ($article_type_list as $k => $v) {			$article_type_list[$k]['list'] = db::table('article')->field("id,title")->where(["status" => "1", 'type_id' => $v['id']])->limit(4)->order("`sort` ASC")->select();		}		return $article_type_list;	}	public function is_login()	{		if (!session('userid')) {			if ($_POST) {				ajax('请先登录');			} else {				redirect('/#login');			}		}		if (session('userid_yidi')) {			redirect('/#yidi');		}	}	public function is_goole()	{		if (session('userid')) {			$user = db::table("user")->where(["id" => $this->userid])->find();			if ($user['google']) {				$arr = explode('|', $user['google']);				if ($arr[1]) {					if (!session('login_google')) {						redirect('/#goole');					}				}			}		}	}	public function show($res = null)	{		if (!$res) {			ajax('参数错误');		}		if ($res[0]) {			ajax('操作成功', 1);		} else {			ajax('操作失败', $res[1]);		}	}	public function ismobile()	{		if (isset($_SERVER['HTTP_X_WAP_PROFILE'])) {			return true;		}		if (isset($_SERVER['HTTP_CLIENT']) && 'PhoneClient' == $_SERVER['HTTP_CLIENT']) {			return true;		}		if (isset($_SERVER['HTTP_VIA'])) {			if (stristr($_SERVER['HTTP_VIA'], 'wap')) {				return true;			}		}		if (isset($_SERVER['HTTP_USER_AGENT'])) {			$clientkeywords = ['nokia', 'sony', 'ericsson', 'mot', 'samsung', 'htc', 'sgh', 'lg', 'sharp', 'sie-', 'philips', 'panasonic', 'alcatel', 'lenovo', 'iphone', 'ipod', 'blackberry', 'meizu', 'android', 'netfront', 'symbian', 'ucweb', 'windowsce', 'palm', 'operamini', 'operamobi', 'openwave', 'nexusone', 'cldc', 'midp', 'wap', 'mobile',];			if (preg_match("/(" . implode('|', $clientkeywords) . ")/i", strtolower($_SERVER['HTTP_USER_AGENT']))) {				return true;			}		}		if (isset($_SERVER['HTTP_ACCEPT'])) {			if ((strpos($_SERVER['HTTP_ACCEPT'], 'vnd.wap.wml') !== false) && (strpos($_SERVER['HTTP_ACCEPT'], 'text/html') === false || (strpos($_SERVER['HTTP_ACCEPT'], 'vnd.wap.wml') < strpos($_SERVER['HTTP_ACCEPT'], 'text/html')))) {				return true;			}		}		return false;	}	public function inc($path)	{		echo __CSS__ . $path;	}}