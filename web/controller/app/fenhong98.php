<?phpnamespace app;use Move\db;class fenhong98 extends home{	public function __construct()	{		parent::__construct();	}	public function index()	{		$where["status#!="] = 0;		$res = parent::pullpage("fenhong98", $where, "id desc");		if ($res) {			$fenhong_poolconfig = db::table('fenhong98_poolconfig')->where(['status' => 1])->select();			if ($fenhong_poolconfig) {				foreach ($res["list"] as $k => $v) {					$res["list"][$k]["addtime"] = addtime($res["list"][$k]["addtime"]);					if ($res["list"][$k]['num'] == 0) $res["list"][$k]['num'] = '分红累计中...';					foreach ($fenhong_poolconfig as $k2 => $v2) {						if ($v['poolid'] == $v2['id']) {							$res["list"][$k]['poolname'] = $v2['name'];							$res["list"][$k]['holdcoin'] = $v2['coin'];						}					}				}			}			ajax($res, 1);		} else {			ajax(['list' => []], 1);		}	}	public function pool()	{		$this->userid = $this->userid(1);		if ($this->userid) {			$user_coin = db::table('user_coin')->where(['userid' => $this->userid])->find();			if (!$user_coin) {				ajax('用户持有币信息错误');			}		}		$poolList = db::table("fenhong98_pool")->where(["status" => 1])->select();		if (!$poolList) {			ajax('暂无可用分红池');		}		$fenhong_poolconfig = db::table('fenhong98_poolconfig')->where(['status' => 1])->select();		if (!$fenhong_poolconfig) {			ajax('暂无分红池配置');		}		foreach ($fenhong_poolconfig as $k => $v) {			if ($this->userid) {				$fenhong_poolconfig[$k]['coinCanUse'] = $user_coin[$v['coin']];			} else {				$fenhong_poolconfig[$k]['coinCanUse'] = '';			}			$poolMoney = 0;			foreach ($poolList as $k2 => $v2) {				if ($v2['poolid'] == $v['id']) {					$poolMoney += $v2['num'];				}			}			$fenhong_poolconfig[$k]['total'] = $poolMoney;		}		ajax($fenhong_poolconfig, 1);	}	public function buy()	{		$id = iv('get.id', 'd', '参数错误');		$where = ['id' => $id];		$fenhong = db::table('fenhong98')->where($where)->order('`sort` asc ,id desc')->find();		if (!$fenhong) {			ajax('分红不存在');		}		$fenhong['endtime'] = addtime($fenhong['endtime']);		$fenhong_poolconfig = db::table('fenhong98_poolconfig')->where(['status' => 1, 'id' => $fenhong['poolid']])->find();		if ($fenhong_poolconfig) {			$fenhong['poolname'] = $fenhong_poolconfig['name'];			$fenhong['holdcoin'] = $fenhong_poolconfig['coin'];		}		ajax($fenhong, 1);	}	public function fenhong98_log()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$where["userid"] = $this->userid;		$res = parent::pullpage("fenhong98_log", $where, "id desc");		$fenhong = db::table('fenhong98')->select();		foreach ($res["list"] as $k => $v) {			$res["list"][$k]["addtime"] = addtime($res["list"][$k]["addtime"]);			if ($fenhong) {				foreach ($fenhong as $k2 => $v2) {					if ($v['fenhongid'] == $v2['id']) $res["list"][$k]["fenhongname"] = $v2['name'];				}			}		}		ajax($res, 1);	}	public function fenhong98_pool_log()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$where["userid"] = $this->userid;		$res = parent::pullpage("fenhong98_pool", $where, "id desc");		$pool_config = db::table('fenhong98_poolconfig')->select();		foreach ($res["list"] as $k => $v) {			$res["list"][$k]["addtime"] = addtime($res["list"][$k]["addtime"]);			$res["list"][$k]["endtime"] = $res["list"][$k]["endtime"] == 0 ? 0 : addtime($res["list"][$k]["endtime"]);			if ($pool_config) {				foreach ($pool_config as $k2 => $v2) {					if ($v['poolid'] == $v2['id']) {						$res["list"][$k]["poolname"] = $v2['name'];						$holdlong = $v['endtime'] == 0 ? (time() - $v['addtime']) : ($v['endtime'] - $v['addtime']);						$holdlong = $holdlong / 86400;						$res["list"][$k]['holdlong'] = $holdlong;					}				}			}		}		ajax($res, 1);	}	public function put_in()	{		$this->set_title('持有分红');		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$id = iv('post.id');		$num = iv("post.num", 'xnb', '存入数量格式错误');		$paypassword = iv("post.paypassword", 'password', '交易密码格式错误');		$res = md('fenhong98')->put_in($this->userid, $id, $num, $paypassword);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function take_out()	{		$this->set_title('分红中心');		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$id = iv('post.id');		$paypassword = iv("post.paypassword", 'password', '交易密码格式错误');		$res = md('fenhong98')->take_out($this->userid, $id, $paypassword);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}}