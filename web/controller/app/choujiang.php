<?phpnamespace app;use Move\db;class choujiang extends home{	public function __construct()	{		parent::__construct();	}	public function index()	{		$res["coin_list"] = db::table("choujiang_coinlist")->where(["status" => 1])->select();		$res["choujiang"] = db::table("choujiang")->select();		$this->userid = $this->userid(1);		if ($this->userid) {			$res["choujiang_num"] = db::table("choujiang_num")->where(["userid" => $this->userid])->find();		}		$res["choujiang_log"] = db::table("choujiang_log")->where(["status#!=" => 0])->order("`id` desc")->limit(7)->select();		foreach ($res["choujiang_log"] as $k => $v) {			$res["choujiang_log"][$k]["addtime"] = addtime($res["choujiang_log"][$k]["addtime"]);			$users = db::table("user")->where(["id" => $v["userid"]])->find();			$res["choujiang_log"][$k]["username"] = substr_replace(str_replace("|", " ", $users['username']), '**', 3, 2);;		}		ajax($res, 1);	}	public function log()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$where["userid"] = $this->userid;		$res = parent::pullpage("choujiang_log", $where, "id desc", 10);		foreach ($res["list"] as $k => $v) {			$res["list"][$k]["addtime"] = addtime($res["list"][$k]["addtime"]);		}		ajax($res, 1);	}	public function buy()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$coinid = iv('post.coinid', 'd', '币种格式错误');		$num = iv('post.num', 'd', '购买数量 格式错误');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		$user = db::table("user")->where(["id" => $this->userid])->find();		if (empty($user['paypassword'])) {			ajax('交易密码非法');		}		if (hashs($paypassword) != $user['paypassword']) {			ajax('交易密码错误');		}		$res = md('choujiang')->buy($coinid, $num, $user['id']);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function up()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$res = md('choujiang')->up($this->userid);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1, $res[2]);		} else {			ajax($res[0]);		}	}}