<?phpnamespace app;use home\safe_alert;use Move\db;class art extends home{	public function __construct()	{		parent::__construct();	}	public function index()	{		$arg = $_REQUEST['arg'];		$res = ["arg" => $arg,];		ajax($res);	}	public function addkey()	{		$sql = "ALTER TABLE `move_debuger` ADD bbb INT(20) NOT NULL, ADD ccc VARCHAR (255) NOT NULL ";		$res = db::query($sql);		echo json_encode($res);	}	public function pushtest()	{		$safe = new safe_alert();		$safe->push_err(['title' => '测试异常推送', 'info' => '这是一条简介', 'content' => '这是详细内容', 'tag' => defined('YC_TAG') ? YC_TAG : 'movesay_none']);	}	public function test()	{		import("jpush");		$appKey = 'bf78cd2068f56352cfd252dc';		$masterSecret = 'b79e0102a479f6406eea15c9';		$client = new \JPush\Client($appKey, $masterSecret);		print_r($client);	}	public function ArtList()	{		$pid = isset($_GET['pid']) ? intval($_GET['pid']) : 0;		$res = db::table("article")->where(["status" => 1, "id#>" => $pid])->order("id desc")->field("id,username,title,value as content,addtime")->order('id desc')->limit(100)->select();		if (!$res) {			ajax('已到最底部', -9);		}		foreach ($res as $_key => $_art) {			preg_match_all('/<img.*?src="(.*?)".*?>/is', $res[$_key]['content'], $img);			$res[$_key]['img'] = isset($img['1']['1']) ? $img['1']['1'] : "";			$res[$_key]['content'] = mb_substr(strip_tags($_art['content']), 0, 100, 'utf-8');			if (!$res[$_key]['content']) $res[$_key]['content'] = '暂无内容';			$res[$_key]['addtime'] = date('Y-m-d H:i', $_art['addtime']);			$res[$_key]['username'] = '管理员';		}		ajax($res, 1);	}	public function ArtShow()	{		$id = isset($_GET['id']) ? (int)$_GET['id'] : "1";		$arr = db::table("article")->where(["status" => 1, "id" => $id])->find();		if ($arr) {			$date = $arr['addtime'];		} else {			$date = time();		}		$ret = array('id' => $arr['id'], 'date' => date('Y-m-d H:i:s', $date), 'source' => '管理员', 'title' => $arr['title'], 'content' => $arr['value'] ? $arr['value'] : '暂无内容');		ajax($ret, 1);	}	public function newslist()	{		$where['status'] = 1;		$where['type_id'] = 2;		$res = parent::pullpage("article", $where, "id desc", 6);		foreach ($res['list'] as $k => $v) {			$res['list'][$k]["addtime"] = date('Y-m-d', $v['addtime']);			$pattern = "/<[img|IMG].*?src=[\'|\"](.*?(?:[\.gif|\.jpg|\.png]))[\'|\"].*?[\/]?>/";			preg_match($pattern, $v['value'], $match);			if ($match) {				$res["list"][$k]['img'] = $match[1];			} else {				$res["list"][$k]['img'] = 'static/img/home/noimg.png';			}		}		if ($res) {			ajax($res, 1);		} else {			ajax('获取资讯出错');		}	}	public function gonggao()	{		$where['status'] = 1;		$where['type_id'] = 1;		$res = parent::pullpage("article", $where, "id desc", 6);		foreach ($res['list'] as $k => $v) {			$res['list'][$k]["addtime"] = date('Y-m-d', $v['addtime']);		}		if ($res) {			ajax($res, 1);		} else {			ajax('获取公告出错');		}	}} 