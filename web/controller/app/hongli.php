<?phpnamespace app;use Move\db;class hongli extends home{	public function __construct()	{		parent::__construct();	}	public function index()	{		$banner = db::table("sys_ad")->where(["type" => "app"])->select();		foreach ($banner as $val) {			$res['banner'][] = $this->host . "/upload/" . $val["img"];		}		$type = db::table("hongli_type")->where(["status" => 1])->select();		$i = 0;		$m = 0;		foreach ($type as $k => $v) {			$hongli = db::table("hongli")->where(["type" => $v["id"], "status" => 1])->order("id  desc")->limit(3)->field("id,name,coinname,feecoin,qi,tian,fee,num,deal,img,type")->select();			foreach ($hongli as $kk => $vv) {				$hongli[$k]["img"] = $this->host . "/upload/" . $vv['img'];			}			$res["data"][$i++]["b"] = $hongli;			$res["data"][$m++]["a"] = $v["type"];		}		ajax($res, 1);	}	public function lists()	{		$res["other"]["hongli_type"] = db::table("hongli_type")->where(["status" => 1])->field("id,type")->select();		$type = iv('get.type', "d", "参数错误", 1);		if (!$type) {			$type = 0;			$where["status#!="] = 0;		} else {			$where["type"] = $type;			$where["status"] = 1;		}		$sort = iv('get.sort', "d", "参数错误", 1);		if (!$sort) {			$sort = 0;			$order = "id";		}		if ($sort == 1) {			$order = "num";		}		if ($sort == 2) {			$order = "tian";		}		if ($sort == 3) {			$order = "fee";		}		$res["other"]["type"] = $type;		$res["other"]["sort"] = $sort;		$res["data"] = parent::pullpage("hongli", $where, $order, 10);		foreach ($res["data"]["list"] as $k => $v) {			$res["data"]["list"][$k]["img"] = $this->host . "/upload/" . $v['img'];		}		ajax($res, 1);	}	public function log()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$where["userid"] = $this->userid;		$res["log"] = parent::pullpage("hongli_log", $where, "id desc", 10);		foreach ($res["log"]["list"] as $k => $v) {			$res["log"]["list"][$k]["addtime"] = addtime($v["addtime"]);			if ($v["endtime"]) {				$res["log"]["list"][$k]["endtime"] = addtime($v["endtime"]);			} else {				$res["log"]["list"][$k]["endtime"] = "----";			}		}		ajax($res, 1);	}	public function fee()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$where["userid"] = $this->userid;		$res["fee"] = parent::pullpage("hongli_fee", $where, "id desc", 10);		foreach ($res["fee"]["list"] as $k => $v) {			$hongli_log = db::table("hongli_log")->where(["id" => $v["hongli_log_id"]])->find();			$res["fee"]["list"][$k]["title"] = $hongli_log["name"];			$res["fee"]["list"][$k]["addtime"] = addtime($v["addtime"]);		}		ajax($res, 1);	}	public function up()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$id = iv('post.id', 'd', '参数错误');		$num = iv('post.num', 'double', '理财数量格式错误');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		$user1 = db::table("user")->where(["id" => session("userid")])->find();		if (!$user1) {			ajax("请先登录");		}		if (hashs($paypassword) != $user1["paypassword"]) {			ajax("交易密码错误");		}		$res = md('hongli')->up($this->userid, $id, $num);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function down()	{		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		}		$id = iv('post.id', 'd', '请选择提取项');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		$user1 = db::table("user")->where(["id" => session("userid")])->find();		if (hashs($paypassword) != $user1["paypassword"]) {			ajax("交易密码错误");		}		$res = md('hongli')->down($this->userid, $id);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function get_info()	{		$id = iv('id', 'd', '参数错误');		$hongli = db::table('hongli')->where(['id' => $id])->find();		$this->userid = $this->userid();		if (!$this->userid) {			ajax('请登录', -99);		} else {			$coin = db::table("user_coin")->where(["userid" => $this->userid])->find();		}		if ($hongli && $coin) {			$arr["coin"] = strtoupper($hongli["coinname"]);			$arr["coinnum"] = $coin[$hongli["coinname"]];			$arr["shenyu"] = $hongli["num"] - $hongli["deal"];		}		if ($arr) {			ajax($arr, 1);		} else {			ajax('数据不存在');		}	}}