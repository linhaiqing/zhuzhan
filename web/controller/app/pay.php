<?phpnamespace app;use Move\db;class pay extends home{	protected $pay_id;	protected $pay_data;	public function __construct()	{		parent::__construct();		if (config("action_name") != "movepay") {			$_GET['ajax'] = 1;			$orderno = "";			$pay_id = isset($_GET['id']) ? intval(trim($_GET['id'])) : (isset($_POST['id']) ? intval(trim($_POST['id'])) : "");			if (!$pay_id) {				if (isset($_POST['BillNo'])) {					$orderno = trim($_POST['BillNo']);				}				if (isset($_POST['orderNo'])) {					$orderno = trim($_POST['orderNo']);				}				if (!check($orderno, "dw")) {					show_msg("订单号码格式错误");				}			}			if ($pay_id || $orderno) {				if ($pay_id) {					$this->cnyin = md('finan_pay')->get_info($pay_id);				}				if ($orderno) {					$this->cnyin = db::table('finan_pay')->where(["tradeno" => $orderno])->find();				}				if (!$this->cnyin) {					show_msg('充值订单错误');				}				$this->cnyin_type = md('finan_type')->find(['name' => $this->cnyin['type']]);				if (!$this->cnyin_type) {					show_msg('充值方式错误');				}				$this->pay_data = ["pay_id" => $this->cnyin['id'], "name" => $this->cnyin_type['name'], "type" => $this->cnyin_type['type'], "title" => '平台充值,单号:' . $this->cnyin['tradeno'], "orderno" => $this->cnyin['tradeno'], "amount" => $this->cnyin['num'], "auth_data" => ["username" => $this->cnyin_type['username'], "password" => $this->cnyin_type['password'], "value" => $this->cnyin_type['value'],],];			}		}	}	public function index()	{		$ty = iv('get.ty');		if ($this->cnyin_type['type'] == "online") {			$this->assign("pay_host", $this->pay_data['auth_data']['value']);			ajax(["ty" => $ty, "id" => $this->pay_data['pay_id'], "name" => $this->pay_data['name'], "title" => $this->pay_data['title'], "orderno" => $this->pay_data['orderno'], "amount" => $this->pay_data['amount'], "pay_url" => $this->pay_data['auth_data']['value'],], 1);		} else {			ajax(["ty" => $ty, "id" => @intval($_GET['id'])], 1);		}	}	public function online()	{		debug($this->pay_data, "pay_data");		$this->pay_data['base_url'] = $_SERVER['REQUEST_SCHEME'] . "://" . APP_HOST . "/app/";;		$payObj = new \ext\pay($this->pay_data);		$payObj->sumbit();	}	public function check_orderno()	{		ajax($this->cnyin['status'], 1);	}	public function return_url()	{		$payObj = new \ext\pay($this->pay_data);		$payObj->return_url();		$this->PayReturn = config("PayReturn");		if (!$_POST || !$this->PayReturn['orderno']) {			ajax("error");		}		show_msg("充值成功");	}	public function notify_url()	{		$payObj = new \ext\pay($this->pay_data);		$payObj->notify_url();	}}