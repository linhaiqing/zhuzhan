<?phpnamespace home;use Move\db;use Move\ext\page;class egg extends home{	public function __construct()	{		parent::__construct();		$this->is_game('egg');	}	public function market()	{		$this->set_title('我的鸡场');		if ($this->userid) {			$user_coin = db::table("user_coin")->where(["userid" => $this->userid])->find();			$this->assign("user_coin", $user_coin);			$egg_user = db::table("egg_user")->where(["userid" => $this->userid])->find();			$this->assign("egg_user", $egg_user);			$where = ["userid" => $this->userid, "status#!=" => 0];			$arr = db::table("egg")->where($where)->count();			$PageObj = new page($arr, 5);			$show = $PageObj->show();			$list = db::table("egg")->where($where)->order("id desc")->limit($PageObj->firstRow, $PageObj->listRows)->select();		} else {			$show = [];			$list = [];		}		$pages = ['show' => $show, 'list' => $list];		$this->assign('pages', $pages);		$this->display();	}	public function index()	{		$this->set_title('我的鸡场');		$arr = db::table("egg_market")->where(["status#!=" => 0])->count();		$PageObj = new page($arr, 10);		$show = $PageObj->show();		$list = db::table("egg_market")->where(["status#!=" => 0])->order("`id` desc")->limit($PageObj->firstRow, $PageObj->listRows)->select();		$pages = ['show' => $show, 'list' => $list];		$this->assign('pages', $pages);		$this->display();	}	public function log()	{		$this->set_title('我的鸡场');		if ($this->userid) {			$where = ["userid" => $this->userid, "status#!=" => 0];			$arr = db::table("egg_log")->where($where)->count();			$PageObj = new page($arr, 10);			$show = $PageObj->show();			$list = db::table("egg_log")->where($where)->order("`id` desc")->limit($PageObj->firstRow, $PageObj->listRows)->select();		} else {			$show = [];			$list = [];		}		$pages = ['show' => $show, 'list' => $list];		$this->assign('pages', $pages);		$this->display();	}	public function egg()	{		$this->set_title('我的鸡场');		if ($this->userid) {			$user_coin = db::table("user_coin")->where(["userid" => $this->userid])->find();			$this->assign("user_coin", $user_coin);			$egg_user = db::table("egg_user")->where(["userid" => $this->userid])->find();			$arr = db::table("egg_farm")->where(["userid" => $this->userid])->count();			$PageObj = new page($arr, 10);			$show = $PageObj->show();			$list = db::table("egg_farm")->where(["userid" => session("userid")])->order("`id` desc")->limit($PageObj->firstRow, $PageObj->listRows)->select();		} else {			$egg_user = [];			$show = [];			$list = [];		}		$pages = ['show' => $show, 'list' => $list];		$this->assign('pages', $pages);		$this->assign("egg_user", $egg_user);		$this->display();	}	public function buy()	{		$id = iv('post.id', 'd', '参数错误');		$num = iv('post.num', 'd', '数量格式错误');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		if (!$this->userid) {			ajax('请先登录');		}		$user = db::table('user')->where(['id' => $this->userid])->find();		if (!$user) {			ajax('用户异常');		}		if (hashs($paypassword) != $user["paypassword"]) {			ajax("交易密码错误");		}		$res = md('egg')->buy($this->userid, $id, $num);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function sell()	{		$id = iv('post.id', 'd', '参数错误');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		$num = 1;		if (!$this->userid) {			ajax('请先登录');		}		$user = db::table('user')->where(['id' => $this->userid])->find();		if (!$user) {			ajax('用户异常');		}		if (hashs($paypassword) != $user["paypassword"]) {			ajax("交易密码错误");		}		$res = md('egg')->sell($this->userid, $id, $num);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function egg_str()	{		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		if (!$this->userid) {			ajax('请先登录');		}		$user = db::table('user')->where(['id' => $this->userid])->find();		if (!$user) {			ajax('用户异常');		}		if (hashs($paypassword) != $user["paypassword"]) {			ajax("交易密码错误");		}		$res = md('egg')->egg_str($this->userid);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function str()	{		$id = iv('post.id', 'd', '参数错误');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		if (!$this->userid) {			ajax('请先登录');		}		$user = db::table('user')->where(['id' => $this->userid])->find();		if (!$user) {			ajax('用户异常');		}		if (hashs($paypassword) != $user["paypassword"]) {			ajax("交易密码错误");		}		$res = md('egg')->str($this->userid, $id);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}	public function get()	{		$id = iv('post.id', 'd', '参数错误');		$paypassword = iv('post.paypassword', 'password', '交易密码格式错误');		if (!$this->userid) {			ajax('请先登录');		}		$user = db::table('user')->where(['id' => $this->userid])->find();		if (!$user) {			ajax('用户异常');		}		if (hashs($paypassword) != $user["paypassword"]) {			ajax("交易密码错误");		}		$res = md('egg')->get($this->userid, $id);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}} 