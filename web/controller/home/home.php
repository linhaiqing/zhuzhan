<?phpnamespace home;use Move\db;class home extends \move\mvc\Controller{	public $config = [];	public $game = [];	public $daohang = [];	public $coin_list = [];	public $coin = [];	public $market_list = [];	public $market = [];	public $user = [];	public $userid = '';	public $user_coin = [];	public $pages = [];	public $hints = [];	public $xnb = [];	public $rmb = [];	public $token = [];	public $seos = [];	public $isRedirect = false;	public function __construct()	{		parent::__construct();		$this->config = md('sys_config')->lists();		if ($this->config['web_close'] != 1) {			exit($this->config['web_close_cause']);		}		if (isset($this->config['api_close'])) {			$this->assign('ms_api', $this->config['api_close']);		} else {			$this->assign('ms_api', 0);		}		$platform = isset($_GET['platform']) ? $_GET['platform'] : '';		$mm = mm();		$is_install_wap = strpos($mm['game'], 'wap');		if (isset($this->config['wap_close']) && $this->config['wap_close'] == 1 && $is_install_wap && $platform != 'app') {			if ($this->ismobile() && isset($this->config['wap_tz']) && $this->config['wap_tz'] == 1) {				if (isset($_GET['invit']) && $_GET['invit']) {					if (check($_GET['invit'], 'dw')) {						session("invit", iv('get.invit'));						if (!session("userid")) {							redirect('/wap/user/reg_h?move_invit=' . $_GET['invit']);						}					}				}				if (cookie("ms_moble_set") != 2 && strtolower(config("controller_name")) != 'wap') {					header('Location:/wap');				} else {				}			}			$this->assign('ms_moble', 1);		} else {			$this->assign('ms_moble', 0);		}		$game_list = mc('home_game');		if (!$game_list) {			$game_list = db::table("version_game")->where(["status" => 1, 'anzhuang' => 1, 'menu' => 1])->order("id asc")->select();			mc('home_game', $game_list);		}		$game = [];		if ($game_list) {			foreach ($game_list as $k => $v) {				$game[$k] = $v;			}		}		$this->game = $game;		$daohang = mc("home_daohang");		if (!$daohang) {			$daohang = db::table('sys_daohang')->where(["status" => 1])->order("`sort` ASC ,id desc")->select();			mc("home_daohang", $daohang, 600);		}		$this->daohang = $daohang;		$lang_type_list = mc("home_lang_type");		if (!$lang_type_list) {			$lang_type = db::table("sys_lang_type")->where(["status" => 1])->order("`sort` ASC ,id desc")->select();			$lang_type_list = [];			if ($lang_type) {				foreach ($lang_type as $k => $v) {					$lang_type_list[$v['name']] = $v;				}			}			mc("home_lang_type", $lang_type_list);		}		$this->lang_type_list = $lang_type_list;		if (cookie('lang')) {			$this->lang_type_cn = isset($lang_type_list[cookie('lang')]) ? $lang_type_list[cookie('lang')] : [];		} else {			if (config('mr_lang')) {				$this->lang_type_cn = $lang_type_list[config('mr_lang')];			} else {				$this->lang_type_cn = isset($lang_type_list['cn']) ? $lang_type_list['cn'] : [];			}		}		$mymc_coin = new \mymc\coin();		$coin_list = $mymc_coin->select();		$this->coin_list = $coin_list;		if (!$this->coin) {			$this->coin = $this->config['mr_coin'];		}		$mymz_trade = new \mymc\trade();		$this->assign('menu', $mymz_trade->daohang());		$market_list = mc("home_market_list");		if (!$market_list) {			$market_list = md('trade')->market_list();			mc("home_market_list", $market_list, 60);		}		$this->market_list = $market_list;		if (!$this->market) {			$this->market = $this->config['mr_market'];		}		if (session("userid")) {			$this->user = db::table('user')->where(['id' => session("userid")])->find();			$this->userid = session("userid");			$this->user_coin = db::table('user_coin')->where(['userid' => session("userid")])->find();		}		if (empty($_POST)) {			if ($this->user) {				$this->user['username'] = substr($this->user['username'], 0, 2) . "***" . substr($this->user['username'], -3, 3);				$this->user['showid'] = $this->user['id'] + 10000;				if (!in_array(config("controller_name"), ['reg'])) {					if (!$this->user['paypassword']) {						session("reg_userid", $this->user['id']);						redirect('/reg/paypassword');					}				}			}			$footer_article = mc("home_footer_article");			if (!$footer_article) {				$footer_article = $this->get_footer_article();				mc("home_footer_article", $footer_article);			}			$this->footer_article = $footer_article;		}		if (empty($_POST)) {		}	}	public function is_login()	{		if (!session('userid')) {			if ($_POST) {				ajax('请先登录');			} else {				redirect('/#login');			}		}		if (session('userid_yidi')) {			redirect('/#yidi');		}	}	public static function is_game($name = null)	{		$info = mc("ms_info_G45T5RBSDGFDS");		if (!$info) {			redirect('/');		}		if (!isset($info["game"]) || !$info["game"]) {			redirect('/');		}		if (in_array($name, explode("|", $info["game"]))) {			$game_list = mc('home_is_game');			if (!$game_list) {				$game_list = db::table("version_game")->order("`sort` ASC")->select();				mc('home_is_game', $game_list);			}			if (!$game_list) {				redirect('/');			}			foreach ($game_list as $k => $v) {				if ($v['name'] == $name) {					if ($v['status'] != 1 || $v['anzhuang'] != 1) {						redirect('/');					} else {						return true;					}				}			}			redirect('/');		} else {			redirect('/');		}	}	public function set_title($title = null)	{		$name = config("controller_name") . "/" . config("action_name");		$data = mc('home_sys_seo_' . $name);		if (!$data) {			$data = db::table("sys_seo")->where(["name" => $name])->find();			if (!$data) {				$res = db::table("sys_seo")->add(["name" => $name, "title" => $title, "status" => 1, "login" => 1, "addtime" => time()]);				if ($res) {					$data = db::table("sys_seo")->where(["name" => $name])->find();				}			}			mc('home_sys_seo_' . $name, $data);		}		if (!isset($data['title']) || !$data['title']) {			$this->seos['title'] = $this->config['web_title'];		} else {			$this->seos['title'] = $this->config['web_title'] . "|" . $data['title'];		}		if (!isset($data['keywords']) || !$data['keywords']) {			$this->seos['keywords'] = $this->config['web_keywords'];		} else {			$this->seos['keywords'] = $data['keywords'];		}		if (!isset($data['description']) || !$data['description']) {			$this->seos['description'] = $this->config['web_description'];		} else {			$this->seos['description'] = $data['description'];		}		if (!isset($data['value']) || !$data['value']) {			$this->hints["value"] = '';		} else {			$this->hints["value"] = $data['value'];		}		if (!isset($data['show']) || !$data['show']) {			$this->hints["show"] = '';		} else {			$this->hints["show"] = $data['show'];		}		if ($name != 'index/index' && (isset($data['login']) && $data['login'] != 1)) {			$this->is_login();		}		if (session("userid") && $name != 'index/index' && $name != 'user/truename' && isset($data['truename']) && $data['truename'] == 1) {			$checkuser = $this->user;			if ($checkuser && (!$checkuser['truename'] || !$checkuser['idcard'])) {				redirect('/user/truename');			}		}	}	public function check_up($title = null)	{		$name = config("controller_name") . "/" . config("action_name");		$data = mc('home_sys_up_' . $name);		if (!$data) {			$data = db::table("sys_seo")->where(["name" => $name])->find();			if (!$data) {				$res = db::table("sys_seo")->add(["name" => $name, "status" => 1, 'title' => $title, "addtime" => time(), "truename" => 1]);				if ($res) {					$data = db::table("sys_seo")->where(["name" => $name])->find();				}			}			if ($data) {				mc('home_sys_up_' . $name, $data);			}		}		if (!session("userid") && config("controller_name") != "reg" && config("controller_name") != "login" && config("controller_name") != "findpwd") {			ajax("请先登录");		}		if ($data['status'] == 0) {			ajax('当前操作被禁止');		}		if (session("userid") && $name != 'user/truename_up' && $data['truename'] == 1 && config("controller_name") != "findpwd" && config("controller_name") != "login" && config("controller_name") != "reg") {			$checkuser = db::table("user")->where(["id" => session("userid")])->find();			if ($checkuser && !($checkuser['truename'] && $checkuser['idcard_rz'])) {				ajax('请补全身份信息再操作', 0, "/user/truename");			}		}	}	public function ajax_lang($value = null)	{		if (!$sys_lang_data = mc('mc_sys_lang_data')) {			$sys_lang = db::table('sys_lang')->where(['type' => 1])->select();			$sys_lang_data = [];			foreach ($sys_lang as $k => $v) {				$sys_lang_data[$v['name']] = $v;			}			mc('mc_sys_lang_data', $sys_lang_data);		}		$lang = cookie("lang");		if (isset($sys_lang_data[$value]) == false) {			db::table('sys_lang')->add(['name' => $value, 'type' => 1]);			db::exec("commit");			mc('mc_sys_lang_data', null);		}		if (isset($sys_lang_data[$value][$lang]) && $sys_lang_data[$value][$lang]) {			return $sys_lang_data[$value][$lang];		} else {			return $value;		}	}	public function is_auth()	{		$name = config("module_name") . "/" . config("controller_name");	}	public function get_footer_article()	{		$article_type_list = db::table('article_type')->field("id,title")->where(["status" => "1", 'type' => 2])->limit(3)->order("`sort` ASC")->select();		foreach ($article_type_list as $k => $v) {			$article_type_list[$k]['list'] = db::table('article')->field("id,title")->where(["status" => "1", 'type_id' => $v['id']])->limit(4)->order("`sort` ASC")->select();		}		return $article_type_list;	}	public function show($res = null)	{		if (!$res) {			ajax('参数错误');		}		if ($res[0]) {			ajax('操作成功', 1);		} else {			ajax('操作失败', $res[1]);		}	}	public function is_yidi()	{	}	public function is_xss()	{	}	public function is_goole()	{		if (session('userid')) {			$user = db::table("user")->where(["id" => session("userid")])->find();			if ($user['google']) {				$arr = explode('|', $user['google']);				if ($arr[1]) {					if (!session('login_google')) {						redirect('/#goole');					}				}			}		}	}	public function ip_check()	{		$myip = get_ip();		$whitelist = db::table('user_ip')->where(['userid' => session('userid')])->find('whitelist');		if (!$whitelist) {			return -1;		} else {			$whitelist = explode(',', $whitelist);			if (in_array($myip, $whitelist)) {				return 1;			} else {				return -2;			}		}	}	public function is_seo()	{		$name = config("module_name") . "/" . config("controller_name");		$sys_seo = mc('sys_seo_' . md5($name));		if (!$sys_seo) {			$sys_seo = db::table("sys_seo")->where(["name" => $name])->find();			if (!$sys_seo && db::table("sys_seo")->add(["name" => $name, "addtime" => time()])) {				$sys_seo = db::table("sys_seo")->where(["name" => $name])->find();			}			mc('sys_seo_' . md5($name), $sys_seo);		}		if (!isset($sys_seo['title']) || !$sys_seo['title']) {			$sys_seo['title'] = $this->config['web_title'];		} else {			$sys_seo['title'] = $this->config['web_title'] . "|" . $sys_seo['title'];		}		if (!isset($sys_seo['keywords']) || !$sys_seo['keywords']) {			$sys_seo['keywords'] = $this->config['web_keywords'];		}		if (!isset($sys_seo['description']) || !$sys_seo['description']) {			$sys_seo['description'] = $this->config['web_description'];		}		$this->assign('sys_seo', $sys_seo);	}	public function is_hints()	{	}	public function ismobile()	{		if (isset($_SERVER['HTTP_X_WAP_PROFILE'])) {			return true;		}		if (isset($_SERVER['HTTP_CLIENT']) && 'PhoneClient' == $_SERVER['HTTP_CLIENT']) {			return true;		}		if (isset($_SERVER['HTTP_VIA'])) {			if (stristr($_SERVER['HTTP_VIA'], 'wap')) {				return true;			}		}		if (isset($_SERVER['HTTP_USER_AGENT'])) {			$clientkeywords = ['nokia', 'sony', 'ericsson', 'mot', 'samsung', 'htc', 'sgh', 'lg', 'sharp', 'sie-', 'philips', 'panasonic', 'alcatel', 'lenovo', 'iphone', 'ipod', 'blackberry', 'meizu', 'android', 'netfront', 'symbian', 'ucweb', 'windowsce', 'palm', 'operamini', 'operamobi', 'openwave', 'nexusone', 'cldc', 'midp', 'wap', 'mobile',];			if (preg_match("/(" . implode('|', $clientkeywords) . ")/i", strtolower($_SERVER['HTTP_USER_AGENT']))) {				return true;			}		}		if (isset($_SERVER['HTTP_ACCEPT'])) {			if ((strpos($_SERVER['HTTP_ACCEPT'], 'vnd.wap.wml') !== false) && (strpos($_SERVER['HTTP_ACCEPT'], 'text/html') === false || (strpos($_SERVER['HTTP_ACCEPT'], 'vnd.wap.wml') < strpos($_SERVER['HTTP_ACCEPT'], 'text/html')))) {				return true;			}		}		return false;	}	function printArray($obj)	{		foreach ($obj as $k => $v) {			if (is_array($v)) {				if (!empty($v[0]) && !is_array($v[0])) {					echo '<br/>';				}				printArray($v);			} else {				echo ' ' . $v . ' ';			}		}	}}