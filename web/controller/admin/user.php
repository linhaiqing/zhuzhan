<?phpnamespace admin;use Move\db;use Move\ext\speal;class user extends admin{	public function __construct()	{		parent::__construct();	}	public function index()	{		$builder = new builder('user');		$builder->title('用户管理', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '用户列表', '/user/index')->button('add', '添加', '/user/edit')->button('no', '禁用', '/user/status/type/0')->button('off', '启用', '/user/status/type/1')->button('del', '删除', '/user/status/type/-1')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('idcard_rz', ['0' => '全部审核', '1' => '没有认证', '2' => '审核通过', '3' => '需要审核'], 'select')->search('field', ['username' => '用户名', 'moble' => '手机号', 'email' => '邮箱', 'truename' => '真实姓名', 'idcard' => '身份证号'], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('username', '用户名', 'text')->key('moble', '手机号', 'text')->key('email', '邮箱', 'text')->key('invit_1', '推荐人', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'invit_1', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'invit_1', 'color' => '',]])->key('truename', '真实姓名', 'text')->key('idcard', '身份证号', 'text')->key("ext1", '实名认证', 'link', [['type' => 'button3', 'url' => '/user/idcard_rz/id/###', 'title' => '实名认证审核', 'field' => 'id', 'color' => '',],])->key('idcard_rz', '实名认证', 'select', [0 => '<span style="color:#DA9151;">没有认证</span>', 1 => '<span style="color:#3498db;">通过认证</span>', 2 => '<span style="color:#ca2784;">需要审核</span>'])->key('addtime', '注册时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>', 2 => '未激活'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],]);		$builder->lists();	}	public function edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("user", ["id" => $id], "edit");			$builder->add_data('set_password', '');			$builder->add_data('set_paypassword', '');			$builder->title(($id ? '编辑用户' : '添加用户'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '用户管理', '/user/index');			$builder->key('id', '编号', 'readonly', '', '数据编号');			$builder->key('id', '编号', 'hidden', '', '数据编号');			$builder->key('username', '用户名', 'text', '', '用户名 (只能字母+数字)');			$builder->key('set_password', '登录密码', 'password', '', '密码不设置不修改');			$builder->key('set_paypassword', '交易密码', 'password', '', '密码不设置不修改');			if (!APP_DEMO) {				$builder->key('moble', '手机号', 'text', '', '手机号 (只能手机号码)');			}			$builder->key('email', '邮箱', 'text', '', '邮箱 (只能邮箱)');			$builder->key('google', '谷歌绑定', 'text', '', '清空此处 即可解绑谷歌认证');			$builder->key('invit_1', '1级上家ID', 'text', '', '用户ID');			$builder->key('invit_2', '2级上家ID', 'text', '', '用户ID');			$builder->key('invit_3', '3级上家ID', 'text', '', '用户ID');			$builder->key('truename', '真实姓名', 'text', '', '真实姓名 (只能真实姓名)');			$builder->key('idcard', '身份证号', 'text', '', '身份证号 (只能身份证号)');			$builder->key('idcard_rz', '实名认证', 'select', [0 => '没有认证', 1 => '通过认证', 2 => '需要审核'], '照片认证');			$builder->key('zzc_pc', '是否参与总资产排名', 'select', [0 => '参与', 1 => '不参与'], '是否参与网站总资产排名');			$builder->key('trade_sh', '是否可以在大盘交易', 'select', [0 => '允许', 1 => '不允许'], '设置用户是否可以在交易中心交易');			$builder->key('addtime', '注册时间', 'time', '', '注册时间 (只能时间)');			$builder->key('status', '状态', 'select', [0 => '禁用', 1 => '启用', 2 => '未激活'], '状态');			$builder->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['username'] = iv('post.username', 'username', '用户名格式错误', 1);			$data['moble'] = iv('post.moble', 'a', '手机号格式错误', 1);			$data['email'] = iv('post.email', 'email', '邮箱格式错误', 1);			$data['truename'] = iv('post.truename', 'truename', '真实姓名格式错误', 1);			$data['google'] = iv('post.google');			$data['idcard'] = iv('post.idcard', 'dw', '身份证号格式错误', 1);			$data['idcard_rz'] = iv('post.idcard_rz', 'd', '照片认证 格式错误', 1);			$data['addtime'] = iv('post.addtime', 'time', '注册时间格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$data['invit_1'] = iv('post.invit_1', 'd', '1级上家ID 格式错误', 1);			$data['invit_2'] = iv('post.invit_2', 'd', '2级上家ID 格式错误', 1);			$data['invit_3'] = iv('post.invit_3', 'd', '3级上家ID 格式错误', 1);			$data['trade_sh'] = iv('post.trade_sh', 'd', '是否可以在大盘交易 格式错误', 1);			$data['zzc_pc'] = iv('post.zzc_pc', 'd', '是否参与总资产排名 格式错误', 1);			if (iv('post.set_password')) {				$data['password'] = hashs(iv('post.set_password', 'password', '登录密码 格式错误', 1));			}			if (iv('post.set_paypassword')) {				$data['paypassword'] = hashs(iv('post.set_paypassword', 'password', '交易密码 格式错误', 1));			}			$id = iv('post.id');			if (!$data['addtime']) {				$data['addtime'] = time();			}			if ($id) {				$res = db::table('user')->where(['id' => $id])->save($data);			} else {				$res = db::table('user')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		if ($type == -1) {			if (empty($id)) {				ajax('请选择操作项');			}			$res = md('user')->delete_user($id);			if (isset($res[1]) && $res[1]) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		} else {			show($builder->set_status($id, $type, 'user'));		}	}	public function admin()	{		$builder = new builder('admin');		$data = $builder->get_data();		foreach ($data as $k => $v) {			$adddata[$k] = $v;			$adddata[$k]['group_id'] = db::table('auth_user')->where(['uid' => $v['id']])->find('group_id');		}		$builder->add_data('', $adddata);		$builder->title('管理员管理', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '管理员列表', '/user/admin')->button('add', '添加', '/user/admin_edit')->button('no', '禁用', '/user/admin_status/type/0')->button('off', '启用', '/user/admin_status/type/1')->button('del', '删除', '/user/admin_status/type/-1')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['username' => '用户名', 'moble' => '手机号', 'email' => '邮箱',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('username', '用户名', 'text')->key('group_id', '所在组', 'link', [['type' => 'button', 'url' => '/auth/user/group_id/###', 'title' => ['from_id' => 'group_id', 'table' => 'auth_group', 'to_id' => 'id', 'title' => 'title'], 'field' => 'group_id', 'color' => '',]])->key('moble', '手机号', 'text')->key('email', '邮箱', 'text')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/admin_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function admin_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("admin", ["id" => $id], "edit");			$builder->add_data('set_password', '');			$builder->title(($id ? '编辑管理员' : '添加管理员'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '管理员管理', '/user/admin')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('username', '用户名', 'text', '', '用户名 (只能字母+数字)')->key('set_password', '密码', 'password', '', '密码 (只能字母+数字)')->key('moble', '手机号', 'text', '', '手机号 (只能手机号码)')->key('email', '邮箱', 'text', '', '邮箱 (只能邮箱)')->key('admin_ip', '允许访问的ip', 'text', '', '允许访问的ip 多个ip用"|"分割  不设置不限制')->key('admin_yidi', '异地登录', 'select', [0 => '不验证', 1 => '验证'], '异地登录后台是否短信验证')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态');			$builder->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['username'] = iv('post.username', 'username', '用户名格式错误', 1);			$data['moble'] = iv('post.moble', 'moble', '手机号格式错误', 1);			$data['email'] = iv('post.email', 'email', '邮箱格式错误', 1);			$data['admin_yidi'] = iv('post.admin_yidi', 'a', '异地登录后台是否短信验证', 1);			$data['admin_ip'] = iv('post.admin_ip', 'a', '允许访问的ip', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			if (iv('post.set_password')) {				$data['password'] = hashs(iv('post.set_password'));			}			if (!isset($data['endtime']) || !$data['endtime']) {				$data['endtime'] = time();			}			$id = iv('post.id');			if ($id) {				$res = db::table('admin')->where(['id' => $id])->save($data);			} else {				if (!isset($data['addtime']) || !$data['addtime']) {					$data['addtime'] = time();				}				$res = db::table('admin')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function admin_status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$builder->set_status($id, $type, 'admin');	}	public function admin_log()	{		$builder = new builder("admin_log");		$builder->title('登录日志', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '日志列表', '/user/log')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'admin', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('type', '类型', 'text')->key('addip', 'IP', 'text')->key('addr', '地址', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">正常</span>'])->lists();	}	public function setpwd()	{		if (empty($_POST)) {			$data['list'] = ['id' => '', 'oldpassword' => '', 'newpassword' => '', 'repassword' => '',];			$builder = new builder();			$builder->data($data)->url()->title('修改密码')->key('oldpassword', '旧密码', 'password', '', '旧密码')->key('newpassword', '新密码', 'password', '', '新密码')->key('repassword', '确认密码', 'password', '', '确认密码')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['oldpassword'] = iv('post.oldpassword', 'password', '旧密码 格式错误');			$data['newpassword'] = iv('post.newpassword', 'password', '新密码 格式错误');			$data['repassword'] = iv('post.repassword', 'password', '确认密码 格式错误');			if ($data['newpassword'] != $data['repassword']) {				ajax('确认密码错误');			}			if (db::table('admin')->where(['id' => session('admin_id')])->save(['password' => hashs($data['newpassword'])])) {				ajax('登录密码修改成功', 1);			} else {				ajax('登录密码修改失败');			}		}	}	public function log()	{		$builder = new builder('user_log');		$builder->title('登录日志', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '日志列表', '/user/log')->button('add', '添加', '/user/log_edit')->button('no', '禁用', '/user/log_status/type/0')->button('off', '启用', '/user/log_status/type/1')->button('del', '删除', '/user/log_status/type/-1')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名', 'addip' => 'ip',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('type', '类型', 'text')->key('remark', '备注', 'text')->key('addip', 'IP', 'text')->key('addr', '地址', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/log_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function log_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("user_log", ["id" => $id], "edit");			$builder->title(($id ? '编辑登录日志' : '添加登录日志'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '登录日志管理', '/user/log')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('userid', '用户id', 'text', '', '用户id')->key('type', '类型', 'text', '', '类型')->key('remark', '备注', 'text', '', '备注')->key('addip', 'IP', 'text', '', 'IP')->key('addr', '地址', 'text', '', '地址')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['userid'] = iv('post.userid', 'd', '用户id格式错误');			$data['type'] = iv('post.type', 'a', '类型格式错误');			$data['remark'] = iv('post.remark', 'a', '备注格式错误');			$data['addip'] = iv('post.addip', 'a', 'IP格式错误');			$data['addr'] = iv('post.addr', 'a', '地址格式错误');			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误');			$data['status'] = iv('post.status', 'd', '状态格式错误');			$id = iv('post.id');			if ($id) {				$res = db::table('user_log')->where(['id' => $id])->save($data);			} else {				$res = db::table('user_log')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function log_status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$builder->set_status($id, $type, 'user_log');	}	public function qianbao()	{		$builder = new builder('user_qianbao');		$builder->title('用户钱包', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '钱包列表', '/user/qianbao')->button('add', '添加', '/user/qianbao_edit')->button('no', '禁用', '/user/qianbao_status/type/0')->button('off', '启用', '/user/qianbao_status/type/1')->button('del', '删除', '/user/qianbao_status/type/-1')->button('ext', '导出所有', '/user/qianbao_excel_all')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('coinname', '币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'coinname', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'coinname', 'color' => '',]])->key('name', '名称', 'text')->key('addr', '地址', 'text')->key('sort', '排序', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/qianbao_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function qianbao_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("user_qianbao", ["id" => $id], "edit");			$builder->title(($id ? '编辑用户钱包' : '添加用户钱包'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '用户钱包管理', '/user/qianbao')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('userid', '用户id', 'text', '', '用户id')->key('coinname', '币种名', 'select', 'coin_c_name_c_title', '币种名')->key('name', '名称', 'text', '', '名称')->key('addr', '地址', 'text', '', '地址')->key('sort', '排序', 'text', '', '排序 (只能数字)')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['userid'] = iv('post.userid', 'd', '用户id格式错误');			$data['coinname'] = iv('post.coinname', 'w', '币种名格式错误');			$data['name'] = iv('post.name', 'a', '名称格式错误');			$data['addr'] = iv('post.addr', 'a', '地址格式错误');			$data['sort'] = iv('post.sort', 'a', '排序格式错误');			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误');			$data['status'] = iv('post.status', 'd', '状态格式错误');			$id = iv('post.id');			if ($id) {				$res = db::table('user_qianbao')->where(['id' => $id])->save($data);			} else {				$res = db::table('user_qianbao')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function qianbao_status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$builder->set_status($id, $type, 'user_qianbao');	}	public function qianbao_excel_all()	{		$tables = 'move_user_qianbao';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_qianbao')->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function bank()	{		$builder = new builder('user_bank');		$builder->title('提现地址', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '地址列表', '/user/bank')->button('add', '添加', '/user/bank_edit')->button('no', '禁用', '/user/bank_status/type/0')->button('off', '启用', '/user/bank_status/type/1')->button('del', '删除', '/user/bank_status/type/-1')->button('ext', '导出所有', '/user/bank_excel_all')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('name', '名称', 'text')->key('bank', '银行', 'text')->key('bankprov', '开户省', 'text')->key('bankcity', '开户市', 'text')->key('bankaddr', '开户地址', 'text')->key('bankcard', '开户账号', 'text')->key('sort', '排序', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/bank_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function bank_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("user_bank", ["id" => $id], "edit");			$builder->title(($id ? '编辑提现地址' : '添加提现地址'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '提现地址管理', '/user/bank')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('userid', '用户id', 'text', '', '用户id')->key('name', '名称', 'text', '', '名称')->key('bank', '银行', 'text', '', '地址')->key('bankprov', '开户省', 'text', '', '地址')->key('bankcity', '开户市', 'text', '', '地址')->key('bankaddr', '开户地址', 'text', '', '地址')->key('bankcard', '开户账号', 'text', '', '地址')->key('sort', '排序', 'text', '', '排序 (只能数字)')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['userid'] = iv('post.userid', 'd', '用户id格式错误');			$data['name'] = iv('post.name', 'a', '名称格式错误');			$data['bank'] = iv('post.bank', 'a', '银行格式错误');			$data['bankprov'] = iv('post.bankprov', 'a', '开户省格式错误');			$data['bankcity'] = iv('post.bankcity', 'a', '开户市格式错误');			$data['bankaddr'] = iv('post.bankaddr', 'a', '开户地址格式错误');			$data['bankcard'] = iv('post.bankcard', 'a', '开户账号格式错误');			$data['sort'] = iv('post.sort', 'a', '排序格式错误');			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误');			$data['status'] = iv('post.status', 'd', '状态格式错误');			$id = iv('post.id');			if ($id) {				$res = db::table('user_bank')->where(['id' => $id])->save($data);			} else {				$res = db::table('user_bank')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function bank_status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$builder->set_status($id, $type, 'user_bank');	}	public function bank_excel_all()	{		$tables = 'move_user_bank';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_bank')->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function coin()	{		$builder = new builder('user_coin');		$builder->url()->title('用户财产', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '财产列表', '/user/coin')->button('ext', '导出选中', '/user/coin_excel')->button('add', '导出所有', '/user/coin_excel_all')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]]);		$data["list"] = $builder->get_data();		$mymc_coin = new \mymc\coin();		$coin = $mymc_coin->select();		foreach ($coin as $key => $val) {			$builder->key($key, "可用" . $val["title"], 'text');			$builder->key($key . 'd', "冻结" . $val["title"], 'text');		}		$builder->lists();	}	public function coin_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$data['list'] = md('user_coin')->find(['id' => $id]);			$builder = new builder();			$builder->url()->title(($id ? '编辑用户财产' : '添加用户财产'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '用户财产管理', '/user/coin')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('userid', '用户id', 'text', '', '用户id');			$mymc_coin = new \mymc\coin();			$coin = $mymc_coin->select();			foreach ($coin as $key => $val) {				if (isset($data['list'][$key])) {					$builder->key($key, '可用' . $val['title'], 'text', '', '请谨慎修改');				}			}			$builder->data($data)->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['userid'] = iv('post.userid', 'd', '用户id格式错误');			$data = iv('post');			$id = iv('post.id');			if ($id) {				$res = md('user_coin')->save(['id' => $id], $data);			} else {				ajax('操作失败', 2);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function coin_excel()	{		if ($_POST) {			$id = $_POST['id'];		} else {			$id = $_GET['id'];		}		if (empty($id)) {			show_msg('请选择要操作的数据!');		}		$tables = 'move_user_coin';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_coin')->where(['id#in' => $id])->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function coin_excel_all()	{		$tables = 'move_user_coin';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_coin')->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function goods()	{		$builder = new builder('user_goods');		$builder->title('联系地址', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '地址列表', '/user/goods')->button('add', '添加', '/user/goods_edit')->button('no', '禁用', '/user/goods_status/type/0')->button('off', '启用', '/user/goods_status/type/1')->button('del', '删除', '/user/goods_status/type/-1')->button('ext', '导出所有', '/user/goods_excel_all')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('name', '名称', 'text')->key('truename', '真实姓名', 'text')->key('idcard', '身份证号', 'text')->key('moble', '手机', 'text')->key('addr', '地址', 'text')->key('sort', '排序', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/goods_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function goods_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("user_goods", ["id" => $id], "edit");			$builder->title(($id ? '编辑联系地址' : '添加联系地址'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '联系地址管理', '/user/goods')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('userid', '用户id', 'text', '', '用户id')->key('name', '名称', 'text', '', '名称')->key('truename', '真实姓名', 'text', '', '真实姓名')->key('idcard', '身份证号', 'text', '', '身份证号')->key('moble', '手机', 'text', '', '手机')->key('addr', '地址', 'text', '', '地址')->key('sort', '排序', 'text', '', '排序 (只能数字)')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['userid'] = iv('post.userid', 'd', '用户id格式错误');			$data['name'] = iv('post.name', 'a', '名称格式错误');			$data['truename'] = iv('post.truename', 'truename', '真实姓名格式错误');			$data['idcard'] = iv('post.idcard', 'idcard', '身份证号格式错误');			$data['moble'] = iv('post.moble', 'moble', '手机格式错误');			$data['addr'] = iv('post.addr', 'a', '地址格式错误');			$data['sort'] = iv('post.sort', 'a', '排序格式错误');			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误');			$data['status'] = iv('post.status', 'd', '状态格式错误');			$id = iv('post.id');			if ($id) {				$res = db::table('user_goods')->where(['id' => $id])->save($data);			} else {				$res = db::table('user_goods')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function goods_status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$builder->set_status($id, $type, 'user_goods', '收货地址状态');	}	public function goods_excel_all()	{		$tables = 'move_user_goods';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_goods')->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function wallet()	{		$builder = new builder('user_wallet');		$builder->title('转入地址', '这里是用户转入地址', '地址列表', '/user/wallet')->button('ext', '导出选中', '/user/wallet_excel')->button('add', '导出所有', '/user/wallet_excel_all')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]]);		$mymc_coin = new \mymc\coin();		$coin = $mymc_coin->select();		foreach ($coin as $k => $v) {			if ($v['wallet'] != "rmb") {				$builder->key($v['name'], $v["title"], 'text');			}		}		$builder->lists();	}	public function wallet_excel()	{		if ($_POST) {			$id = $_POST['id'];		} else {			$id = $_GET['id'];		}		if (empty($id)) {			show_msg('请选择要操作的数据!');		}		$tables = 'move_user_wallet';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_wallet')->where(['id#in' => $id])->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function wallet_excel_all()	{		$tables = 'move_user_wallet';		$xls_name = $tables;		$xls_zd = [];		$db_config = config("DB_CONF");		$zd = db::query("select COLUMN_NAME,COLUMN_COMMENT from information_schema.COLUMNS where TABLE_SCHEMA = '" . $db_config['db_name'] . "' and TABLE_NAME = '" . $tables . "';");		foreach ($zd as $k => $v) {			$xls_zd[$k] = $v['COLUMN_COMMENT'] ? $v['COLUMN_COMMENT'] : $v['COLUMN_NAME'];		}		$xls_rs = db::table('user_wallet')->select();		$excel = new \ext\excel();		$excel->export($xls_name, $xls_zd, $xls_rs);	}	public function action()	{		$builder = new builder("auth_action");		$builder->title('行为管理', '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '行为列表', '/user/action')->button('add', '添加', '/user/action_edit')->button('no', '禁用', '/user/action_status/type/0')->button('off', '启用', '/user/action_status/type/1')->button('del', '删除', '/user/action_status/type/-1')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['title' => '标题',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('name', '标识', 'text')->key('title', '标题', 'text')->key('remark', '描述', 'text')->key('sort', '排序', 'text')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/action_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function action_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("auth_action", ["id" => $id], "edit");			$builder->title(($id ? '编辑行为' : '添加行为'), '<a href="http://www.movesay.com/article/detail/id/19.html" target="_blank"> 功能说明 http://www.movesay.com/article/detail/id/19.html</a>', '行为管理', '/user/action');			if ($id) {				$builder->key('id', '编号', 'readonly', '', '数据编号');				$builder->key('id', '编号', 'hidden', '', '数据编号');			}			$builder->key('name', '行为标识', 'text', '', '由英文字母和下划线组成');			$builder->key('title', '行为名称', 'text', '', '行为名称');			$builder->key('remark', '行为描述', 'text', '', '行为描述');			$builder->key('sort', '排序', 'text', '', '排序 (只能数字)');			$builder->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)  不填会增自动生成');			$builder->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['name'] = iv('post.name', 'w_', '行为标识 格式错误', 1);			$data['title'] = iv('post.title', '', '行为名称 格式错误', 1);			$data['remark'] = iv('post.remark', '', '行为描述 格式错误', 1);			$data['sort'] = iv('post.sort', 'd', '排序格式错误 只能是数字', 1);			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id', 'd', '参数错误', 1);			if ($id) {				$data['endtime'] = time();				$res = db::table('auth_action')->where(['id' => $id])->save($data);			} else {				$res = db::table('auth_action')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function action_status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$res = $builder->set_status($id, $type, 'auth_action', '行为状态');		if (isset($res[1])) {			ajax('操作成功', 1);		} else {			ajax('操作失败');		}	}	public function action_log()	{		$builder = new builder("auth_action_log");		$builder->title('行为日志', '这里是行为日志', '日志列表', '/user/action_log')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['title' => '标题',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('name', '行为名称', 'text')->key('adminid', '执行着', 'link', [['type' => 'button', 'url' => '/user/admin/field/id/name/###', 'title' => ['from_id' => 'adminid', 'table' => 'admin', 'to_id' => 'id', 'title' => 'username'], 'field' => 'adminid', 'color' => '',]])->key('ip', '标题', 'text')->key('sort', '排序', 'text')->key('addtime', '添加时间', 'time')->lists();	}	public function idcard_rz()	{		$config = md('sys_config')->lists();		$id = iv('get.id', 'd', '');		if (isset($config['idrard_img_rz']) && !$config['idrard_img_rz']) {			redirect('/admin/user/edit/id/' . $id);		}		$user_img = db::table('user')->where(['id' => $id])->find();		if ($user_img['idcard_img']) {			$idcard_img = json_decode($user_img['idcard_img']);			foreach ($idcard_img as $k => $v) {				$user_img['img' . $k] = file_get_contents($v);			}		}		$this->assign('user_img', $user_img);		$this->display();	}	public function idcard_check()	{		$userid = iv('post.id', 'd', '参数错误');		$status = iv('post.status', 'd', '参数错误');		$res = db::table('user')->where(['id' => $userid])->save(['idcard_rz' => $status]);		if ($res) {			ajax('修改成功', 1);		} else {			ajax('修改失败');		}	}	public function client()	{		$builder = new builder('client');		$builder->title('客户管理', '', '客户列表', '/user/client')->button('add', '添加', '/user/client_edit')->button('no', '禁用', '/user/client_status/type/0')->button('off', '启用', '/user/client_status/type/1')->button('del', '删除', '/user/client_status/type/-1')->key('id', 'ID', 'text')->key('clientname', '客户名', 'text')->key('username', '用户名', 'text')->key('password', '加密密码', 'text')->key('moble', '手机号', 'text')->key('tag', '绑定tag', 'text')->key('device', '绑定设备id', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/user/client_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function client_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("client", ["id" => $id], "edit");			$builder->add_data('set_password', '');			$builder->title(($id ? '编辑客户' : '添加客户'), '', '客户管理', '/user/client')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('clientname', '客户名', 'text', '', '客户名')->key('username', '用户名', 'text', '', '用户名 (只能字母+数字)')->key('set_password', '密码', 'password', '', '密码 (只能字母+数字)')->key('moble', '手机号', 'text', '', '手机号 (只能手机号码)')->key('tag', '推送的tag', 'text', '', 'tag是异常推送的组，一个客户一个组')->key('device', '绑定的设备', 'text', '', '绑定时自动生成，用户绑定的设备id')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '状态');			$builder->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['clientname'] = iv('post.clientname', '', '', 1);			$data['username'] = iv('post.username', 'username', '用户名格式错误', 1);			$data['moble'] = iv('post.moble', 'moble', '手机号格式错误', 1);			$data['tag'] = iv('post.tag', '', '', 1);			$data['device'] = iv('post.device', 'a', '设备id错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			if (iv('post.set_password')) {				$data['password'] = hashs(iv('post.set_password'));			}			$id = iv('post.id');			if ($id) {				$res = db::table('client')->where(['id' => $id])->save($data);			} else {				$res = db::table('client')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function client_status()	{		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$builder->set_status($id, $type, 'client');	}} 