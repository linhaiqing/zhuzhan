<?phpnamespace admin;use Move\db;class gift extends admin{	public function __construct()	{		parent::__construct();	}	public function index()	{		$builder = new builder("gift");		$builder->title('转入赠送', '这里是转入赠送', '转入赠送', '/gift/index')->search('field', ['userid' => '用户ID', 'coinname' => '转入币种',], 'select')->search('name', '请输入查询内容', 'text')->key('id', '编号', 'text')->key('coin_in_id', '转入记录ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('coinname', '转入币种', 'text')->key('coinnum', '转入数量', 'text')->key('giftcoin', '赠送币种', 'text')->key('giftnum', '赠送数量', 'text')->key('addtime', '到帐时间', 'time')->key('status', '状态', 'select', [0 => "赠送失败", 1 => "赠送成功"])->lists();	}	public function bufa($id)	{	}	public function config()	{		$builder = new builder("gift_config");		$builder->title('赠送配置', '', '配置列表', 'gift/config')->button('add', '添加', '/gift/config_edit')->button('no', '禁用', '/gift/configStatus/type/0')->button('off', '启用', '/gift/configStatus/type/1')->button('del', '删除', '/gift/configStatus/type/-1')->key('id', '编号', 'text')->key('in_coinname', '转入币种名', 'text')->key('gift_coinname', '赠送币种名', 'text')->key('bili', '赠送比例', 'text', '', '%,填写百分数的百分号前面的部分，如3.26%填写3.26')->key('start_time', '开始日期', 'time')->key('end_time', '结束日期', 'time')->key('status', '状态', 'select', [0 => "禁用", 1 => "已启用"])->lists();	}	public function configStatus()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		show($builder->set_status($id, $type, 'gift_config'));	}	public function config_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("gift_config", ["id" => $id], "edit");			$builder->title(($id ? '编辑赠送配置' : '添加赠送配置'), '', '赠送配置', '/gift/config')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('in_coinname', '转入币种名', 'text', '', '转入币种名')->key('gift_coinname', '赠送币种名', 'text', '', '赠送的币种的英文名')->key('bili', '赠送比例', 'text', '', '%，赠送数量/转入数量*100%，如3.26%填写3.26')->key('start_time', '开始日期', 'time', '', '开始日期前的转入不会赠送')->key('end_time', '结束日期', 'time', '', '结束日期后的转入不会赠送')->key('status', '状态', 'select', [0 => "禁用", 1 => "已启用"])->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['in_coinname'] = iv('post.in_coinname', 'a', '转入币种名 格式错误', 1);			$data['gift_coinname'] = iv('post.gift_coinname', 'a', '赠送币种名 格式错误', 1);			$data['bili'] = iv('post.bili', 'double', '赠送比例(赠送数量/转入数量*100%) 格式错误', 1);			$data['start_time'] = iv('post.start_time', 'time', '开始时间 格式错误', 1);			$data['end_time'] = iv('post.end_time', 'time', '结束时间 格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态 格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table("gift_config")->where(["id" => $id])->save($data);			} else {				$res = db::table("gift_config")->add($data);			}			if ($res) {				ajax('操作成功', 1, "/admin/gift/config");			} else {				ajax('操作失败');			}		}	}}