<?phpnamespace admin;use Move\db;class issue extends admin{	public function __construct()	{		parent::__construct();		// if (!$this->is_game('issue')) {		// 	ajax('这个应用你没有购买');		// }	}	public function index()	{		$builder = new builder("issue");		$builder->title('认购管理', '这里是认购管理', '认购列表', '/issue/index')->button('add', '添加', '/issue/edit')->button('no', '禁用', '/issue/status/type/0')->button('off', '启用', '/issue/status/type/1')->button('del', '删除', '/issue/status/type/-1')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['name' => '认购名称', 'coinname_c_coin_c_name_c_title' => '认购币种', 'username_c_coin_c_name_c_title' => '付款币种',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('name', '认购名称', 'text')->key('coinname', '认购币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'coinname', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'coinname', 'color' => '',]])->key('buycoin', '付款币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'buycoin', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'buycoin', 'color' => '',]])->key('num', '认购总量', 'text')->key('deal', '已认购量', 'text')->key('price', '认购价格', 'text')->key('limit', '认购限量', 'text')->key('ci', '解冻次数', 'text')->key('jian', '解冻间隔', 'text')->key('strtime', '开启时间', 'time')->key('sndtime', '结束时间', 'time')->key('sort', '排序', 'text')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/issue/edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',]]);		$builder->lists();	}	public function log()	{		$builder = new builder("issue_log");		$builder->title('认购记录', '这里是认购记录', '认购记录', '/issue/log')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['name' => '认购名称', 'coinname_c_coin_c_name_c_title' => '认购币种', 'username_c_coin_c_name_c_title' => '付款币种', 'userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/edit/id/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('name', '认购名称', 'text')->key('coinname', '认购币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'coinname', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'coinname', 'color' => '',]])->key('buycoin', '认购币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'buycoin', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'buycoin', 'color' => '',]])->key('price', '认购价格', 'text')->key('num', '认购数量', 'text')->key('mum', '认购总额', 'text')->key('ci', '解冻次数', 'text')->key('jian', '解冻间隔', 'text')->key('addtime', '认购时间', 'time')->key('jd', '解冻状态', 'text')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">解冻中</span>', 1 => '<span style="color:#3498db;">已完成</span>'])->lists();	}	public function invit()	{		$builder = new builder("issue_invit");		$builder->title('认购赠送', '这里是认购赠送', '认购赠送', '/issue/invit')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '已申请', '2' => '提现成功', '3' => '已撤销', '4' => '正在处理'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('invit', '推荐人', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'invit', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('type', '奖励类型', 'text')->key('name', '奖励说明', 'text')->key('num', '操作数量', 'text')->key('fee', '到账数量', 'text')->key('feecoin', '到账币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'feecoin', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'feecoin', 'color' => '',]])->key('addtime', '操作时间', 'time')->lists();	}	public function edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("issue", ["id" => $id], "edit");			$builder->title(($id ? '编辑认购' : '添加认购'), ($id ? '这里是编辑认购' : '这里是添加认购'), '认购管理', '/issue/index')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('name', '认购名称', 'text', '', '名称(只能中文)')->key('coinname', '认购币种', 'select', 'coin_c_name_c_title', '')->key('buycoin', '付款币种', 'select', 'coin_c_name_c_title', '')->key('num', '认购总量', 'text', '', '认购总量(只能整数)')->key('deal', '已认购量', 'text', '', '已认购量(只能整数)')->key('price', '认购价格', 'text', '', '认购价格(数字)')->key('limit', '认购限量 ', 'text', '', '认购限量(只能整数)')->key('ci', '解冻次数', 'text', '', '次(只能整数)')->key('jian', '解冻间隔', 'text', '', '小时 (只能整数)')->key('jiedong', '开始解冻方式', 'select', [0 => '购买后开始计算', 1 => '当前认购结束开始计算'], '用户认购后的解冻方式')->key('min', '单次最小', 'text', '', '最小(只能整数)')->key('max', '单次最大', 'text', '', '最大(只能整数)')->key('buy_log_show', '购买界面记录', 'select', [0 => '不显示', 1 => '显示'], '')->key('invit_kai', '是否开启赠送', 'select', [0 => '禁止', 1 => '开启'], '')->key('invit_coin', '推荐赠送币种', 'select', 'coin_c_name_c_title', '')->key('invit_fee', '自己赠送比例', 'text', '', '%(两位小数)')->key('invit_1', '一代赠送比例', 'text', '', '%(两位小数)')->key('invit_2', '二代赠送比例', 'text', '', '%(两位小数)')->key('invit_3', '三代赠送比例', 'text', '', '%(两位小数)')->key('strtime', '开始时间', 'time', '', '开始时间 (只能时间)')->key('sndtime', '结束时间', 'time', '', '结束时间 (只能时间)')->key('content', '认购说明', 'editor', '', '认购说明')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('endtime', '更新时间', 'time', '', '更新时间 (只能时间)')->key('sort', '排序', 'text', '', ' 排序(只能整数)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['name'] = iv('post.name', 'a', '认购名称格式错误', 1);			$data['coinname'] = iv('post.coinname', 'w', '认购币种 格式错误', 1);			$data['buycoin'] = iv('post.buycoin', 'w', '付款币种 格式错误');			$data['num'] = iv('post.num', 'd', '认购总量 格式错误', 1);			$data['deal'] = iv('post.deal', 'd', '已认购量 格式错误', 1);			$data['price'] = iv('post.price', 'xnb', '认购价格 格式错误', 1);			$data['limit'] = iv('post.limit', 'd', '限购数量 格式错误', 1);			$data['ci'] = iv('post.ci', 'd', '解冻次数 格式错误');			$data['jian'] = iv('post.jian', 'd', '解冻间隔 格式错误', 1);			$data['jiedong'] = iv('post.jiedong', 'd', '开始解冻方式 格式错误', 1);			$data['buy_log_show'] = iv('post.buy_log_show', 'd', '购买界面记录 格式错误', 1);			$data['min'] = iv('post.min', 'd', '单次最小 格式错误', 1);			$data['max'] = iv('post.max', 'd', '单次最大 格式错误', 1);			$data['invit_kai'] = iv('post.invit_kai', 'd', '开启禁止 格式错误', 1);			$data['invit_coin'] = iv('post.invit_coin', 'w', '推荐赠送币种 格式错误', 1);			$data['invit_fee'] = iv('post.invit_fee', 'cny', '自己赠送比例 格式错误', 1);			$data['invit_1'] = iv('post.invit_1', 'cny', '一代赠送比例 格式错误', 1);			$data['invit_2'] = iv('post.invit_2', 'cny', '二代赠送比例 格式错误', 1);			$data['invit_3'] = iv('post.invit_3', 'cny', '三代赠送比例 格式错误', 1);			$data['content'] = iv('post.content');			$data['sort'] = iv('post.sort', 'd', '排序格式错误', 1);			$data['strtime'] = iv('post.strtime', 'time', '开始时间格式错误', 1);			$data['sndtime'] = iv('post.sndtime', 'time', '结束时间格式错误', 1);			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误', 1);			$data['endtime'] = iv('post.endtime', 'time', '更新时间格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table('issue')->where(['id' => $id])->save($data);			} else {				$res = db::table('issue')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		show($builder->set_status($id, $type, 'issue'));	}}