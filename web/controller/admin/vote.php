<?phpnamespace admin;use Move\db;use Move\config;use Move\cache;class vote extends admin{	public function __construct()	{		parent::__construct();		if (!$this->is_game('vote')) {			ajax('这个应用你没有购买');		}	}	public function index()	{		$builder = new builder("vote");		$builder->title('投票管理', '这里是投票管理', '投票列表', '/vote/index')->button('add', '添加', '/vote/edit')->button('no', '禁用', '/vote/status/type/0')->button('off', '启用', '/vote/status/type/1')->button('del', '删除', '/vote/status/type/-1')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['name' => '名称',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('name', '认购名称', 'text')->key('title', '标题', 'text')->key('img', '图片', 'img')->key('zc', '赞成', 'text')->key('fd', '反对', 'text')->key('zj', '总计', 'text')->key('sort', '排序', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/vote/edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',]])->lists();	}	public function log()	{		$builder = new builder("vote_log");		$builder->title('投票记录', '这里是投票记录', '投票记录', '/vote/log')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['name' => '名称',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/edit/id/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('coinid', '投票币种', 'link', [['type' => 'button', 'url' => '/user/edit/id/###', 'title' => ['from_id' => 'coinid', 'table' => 'vote', 'to_id' => 'id', 'title' => 'title'], 'field' => 'coinid', 'color' => '',]])->key('type', '投票类型', 'text')->key('ext', '投票原因', 'text')->key('addtime', '投票时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">失败</span>', 1 => '<span style="color:#3498db;">成功</span>'])->lists();	}	public function edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("vote", ["id" => $id], "edit");			$builder->title(($id ? '编辑投票' : '添加投票'), ($id ? '这里是编辑投票' : '这里是添加投票'), '投票管理', '/vote/index')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('name', '名称', 'text', '', '名称(英文)')->key('title', '标题', 'text', '', '标题(中文)')->key('img', '图片', 'image', '', '图片 (全部格式)')->key('cs', '创世贴', 'editor', '', '(全部格式)')->key('zc', '赞成', 'text', '', '赞成(只能整数)')->key('fd', '反对', 'text', '', '反对(只能整数)')->key('zj', '总计', 'text', '', '总计(只能整数)')->key('addtime', '添加时间', 'time', '', '添加时间 (只能时间)')->key('sort', '排序', 'text', '', '排序(整数)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['name'] = iv('post.name', 'w', '名称格式错误', 1);			$data['title'] = iv('post.title', 'a', '标题格式错误', 1);			$data['img'] = iv('post.img', 'a', '图片 格式错误', 1);			$data['cs'] = iv('post.cs');			$data['zc'] = iv('post.zc', 'd', '赞成 格式错误', 1);			$data['fd'] = iv('post.fd', 'd', '反对 格式错误', 1);			$data['zj'] = iv('post.zj', 'd', '总计 格式错误', 1);			$data['sort'] = iv('post.sort', 'd', '排序格式错误', 1);			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table('vote')->where(['id' => $id])->save($data);			} else {				$res = db::table('vote')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		show($builder->set_status($id, $type, 'vote'));	}}