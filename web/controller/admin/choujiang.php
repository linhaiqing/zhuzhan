<?phpnamespace admin;use Move\db;class choujiang extends admin{	public function __construct()	{		parent::__construct();		if (!$this->is_game('choujiang')) {			ajax('这个应用你没有购买');		}	}	public function index()	{		$cunzai = db::query("SHOW TABLES LIKE 'move_choujiang';");		if (isset($cunzai[0])) {			$choujiang = db::table('choujiang')->find();			if (!$choujiang) {				for ($i = 1; $i < 13; $i++) {					db::table('choujiang')->add(['id' => $i, 'title' => '请设置']);				}			}		}		$builder = new builder("choujiang");		$builder->title('奖品管理', '这里是奖品管理', '奖品列表', '/choujiang/index')->button('no', '禁用', '/choujiang/status/type/0')->button('off', '启用', '/choujiang/status/type/1')->search('field', ['id' => '奖品ID', "status" => "状态"], 'select')->search('name', '请输入查询内容', 'text')->key('id', '奖品ID', 'text')->key('title', '奖品名称', 'text')->key('value', '奖励数量', 'text')->key('type', '奖品类型', 'text')->key('gailv', '中奖概率', 'text')->key('addtime', '开始时间', 'time')->key('status', '奖品状态', 'select', [0 => "禁用", 1 => "启用"])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/choujiang/edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',]])->lists();	}	public function edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("choujiang", ["id" => $id], "edit");			$builder->title(($id ? '编辑奖品' : '添加奖品'), ($id ? '这里是编辑奖品' : '这里是添加奖品'), '奖品管理', '/choujiang/index')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('title', '奖品名', 'text', '', '奖品标题(全部格式)')->key('type', '类型', 'select', 'coin_c_name_c_title', '类型(英文小写格式)')->key('value', '奖励数', 'text', '', '奖励数(整数格式)')->key('gailv', '中奖概率', 'text', '', '中奖概率(小数格式)')->key('status', '状态', 'select', [0 => "禁用", 1 => "启用"], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['title'] = iv('post.title', 'a', '标题 格式错误', 1);			$data['type'] = iv('post.type', 'w', '类型 格式错误');			$data['value'] = iv('post.value', 'd', '奖励数量 格式错误', 1);			$data['gailv'] = iv('post.gailv', "double", '中奖概率格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table("choujiang")->where(["id" => $id])->save($data);			} else {				$res = db::table("choujiang")->add($data);			}			if ($res) {				ajax('操作成功', 1, "/admin/choujiang/index");			} else {				ajax('操作失败');			}		}	}	public function status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$res = $builder->set_status($id, $type, 'choujiang');		if (isset($res[1])) {			ajax('操作成功', 1);		} else {			ajax('操作失败');		}	}	public function log()	{		$builder = new builder("choujiang_log");		$builder->title('抽奖记录', '这里是抽奖记录', '抽奖记录', '/choujiang/log')->button('add', '添加', '/choujiang/log_edit')->button('del', '删除', '/choujiang/log_status/type/-1')->search('userid', '用户ID', 'd')->search('status', ['0' => '禁用', '1' => '启用'], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('addtime', '抽奖时间', 'time')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('title', '奖励名称', 'text')->key('type', '奖励类型', 'text')->key('value', '奖励数量', 'text')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:red;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/choujiang/log_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function log_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("choujiang_log", ["id" => $id], "edit");			$builder->title(($id ? '编辑抽奖记录' : '添加抽奖记录'), ($id ? '这里是编辑抽奖记录' : '这里是添加抽奖记录'), '抽奖记录管理', '/choujiang/log');			if ($id) {				$builder->key('id', '编号', 'readonly', '', '数据编号');				$builder->key('id', '编号', 'hidden', '', '数据编号');			}			$builder->key('addtime', '下单时间', 'time', '', '购买时间(时间格式)')->key('userid', '用户ID', 'text', '', '用户ID(整数格式)')->key('title', '奖励名称', 'text', '', '奖励名称(全部格式)')->key('type', '奖励类型', 'select', 'coin_c_name_c_title', '奖励类型')->key('value', '奖励数量', 'text', '', '奖励数量(整数格式)')->key('addtime', '抽奖时间', 'time', '', '抽奖时间(时间格式)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['addtime'] = iv('post.addtime', 'time', '下单时间格式错误', 1);			$data['userid'] = iv('post.userid', 'd', '用户ID 格式错误', 1);			$data['title'] = iv('post.title', 'a', '奖励名称 格式错误', 1);			$data['type'] = iv('post.type', 'w', '奖励类型 格式错误', 1);			$data['value'] = iv('post.value', 'd', '奖励数量 格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table('choujiang_log')->where(['id' => $id])->save($data);			} else {				$res = db::table('choujiang_log')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function log_status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$res = $builder->set_status($id, $type, 'choujiang_log');		if (isset($res[1])) {			ajax('操作成功', 1);		} else {			ajax('操作失败');		}	}	public function coinlist()	{		$builder = new builder("choujiang_coinlist");		$builder->title('付款币种', '这里是付款币种', '付款币种列表', '/choujiang/coinlist')->button('add', '添加', '/choujiang/coinlist_edit')->button('no', '禁用', '/choujiang/coinlist_status/type/0')->button('off', '启用', '/choujiang/coinlist_status/type/1')->button('del', '删除', '/choujiang/coinlist_status/type/-1')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['name' => '类型名称',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('name', '付款币种', 'text')->key('title', '币种名称', 'text')->key('price', '价格', 'text')->key('addtime', '添加时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/choujiang/coinlist_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',],])->lists();	}	public function coinlist_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("choujiang_coinlist", ["id" => $id], "edit");			$builder->title(($id ? '编辑付款币种' : '添加付款币种'), ($id ? '这里是编辑付款币种' : '这里是添加付款币种'), '付款币种管理', '/choujiang/coinlist');			if ($id) {				$builder->key('id', '编号', 'readonly', '', '数据编号');				$builder->key('id', '编号', 'hidden', '', '数据编号');			}			$builder->key('name', '付款币种', 'select', 'coin_c_name_c_name', '付款币种')->key('title', '付款币种名称', 'text', '', '付款币种名称(全部格式)')->key('price', '交易价格', 'text', '', '多少该币买一个抽奖券(整数格式)')->key('addtime', '添加时间', 'time', '', '添加时间  (时间格式)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['name'] = iv('post.name', 'w', '付款币种 格式错误', 1);			$data['title'] = iv('post.title', 'a', '付款币种名称 格式错误', 1);			$data['price'] = iv('post.price', 'double', '付款币种交易价格 格式错误', 1);			$data['addtime'] = iv('post.addtime', 'time', '添加时间格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table('choujiang_coinlist')->where(['id' => $id])->save($data);			} else {				$res = db::table('choujiang_coinlist')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function coinlist_status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		$res = $builder->set_status($id, $type, 'choujiang_coinlist');		if (isset($res[1])) {			ajax('操作成功', 1);		} else {			ajax('操作失败');		}	}}