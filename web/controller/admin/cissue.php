<?phpnamespace admin;use Move\db;class cissue extends admin{	public function __construct()	{		parent::__construct();	}	public function index()	{		if (empty($_POST)) {			$id = db::table('cissue')->find('id');			$builder = new builder("cissue", ["id" => $id], "edit");			$builder->title(($id ? '认购设置' : '认购设置'), ($id ? '这里是认购设置' : '这里是认购设置'), '认购设置', '/cissue/index')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('alipay', '支付宝', 'image', '', '支付宝收款码')->key('wechat', '微信', 'image', '', '微信收款码')->key('bank', '银行', 'text', '', '银行账户信息')->key('name', '认购名称', 'text', '', '名称(只能中文)')->key('coinname', '认购币种', 'select', 'coin_c_name_c_title', '')->key('buycoin', '付款币种', 'select', 'coin_c_name_c_title', '')->key('num', '认购总量', 'text', '', '认购总量(只能整数)')->key('price', '认购价格', 'text', '', '认购价格(数字)')->key('ci', '解冻次数', 'text', '', '次(只能整数)')->key('jian', '解冻间隔', 'text', '', '小时 (只能整数)')->key('jiedong', '开始解冻方式', 'select', [0 => '购买后开始计算', 1 => '当前认购结束开始计算'], '用户认购后的解冻方式')->key('min', '单次最小金额', 'text', '', '最小(只能整数)')->key('max', '单次最大金额', 'text', '', '最大(只能整数)')->key('invit_kai', '是否开启赠送', 'select', [0 => '禁止', 1 => '开启'], '')->key('invit_coin', '推荐赠送币种', 'select', 'coin_c_name_c_title', '')->key('invit_fee', '自己赠送比例', 'text', '', '%(两位小数)')->key('invit_type', '比例参考值', 'select', [0 => '认购数量', 1 => '认购金额'], '推荐赠送比例参考标准')->key('invit_1', '一代赠送比例', 'text', '', '%(两位小数)')->key('invit_2', '二代赠送比例', 'text', '', '%(两位小数)')->key('invit_3', '三代赠送比例', 'text', '', '%(两位小数)')->key('strtime', '开始时间', 'time', '', '开始时间 (只能时间)')->key('sndtime', '结束时间', 'time', '', '结束时间 (只能时间)')->key('content', '认购说明', 'editor', '', '认购说明')->key('sort', '排序', 'text', '', ' 排序(只能整数)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['alipay'] = iv('post.alipay', 'a', '', 1);			$data['wechat'] = iv('post.wechat', 'a', '', 1);			$data['bank'] = iv('post.bank', 'a', '', 1);			$data['name'] = iv('post.name', 'a', '认购名称格式错误', 1);			$data['coinname'] = iv('post.coinname', 'w', '认购币种 格式错误', 1);			$data['buycoin'] = iv('post.buycoin', 'w', '付款币种 格式错误');			$data['num'] = iv('post.num', 'd', '认购总量 格式错误', 1);			$data['price'] = iv('post.price', 'xnb', '认购价格 格式错误', 1);			$data['ci'] = iv('post.ci', 'd', '解冻次数 格式错误');			$data['jian'] = iv('post.jian', 'd', '解冻间隔 格式错误', 1);			$data['jiedong'] = iv('post.jiedong', 'd', '开始解冻方式 格式错误', 1);			$data['min'] = iv('post.min', 'd', '单次最小 格式错误', 1);			$data['max'] = iv('post.max', 'd', '单次最大 格式错误', 1);			$data['invit_kai'] = iv('post.invit_kai', 'd', '开启禁止 格式错误', 1);			$data['invit_coin'] = iv('post.invit_coin', 'w', '推荐赠送币种 格式错误', 1);			$data['invit_fee'] = iv('post.invit_fee', 'cny', '自己赠送比例 格式错误', 1);			$data['invit_type'] = iv('post.invit_type', 'd', '比例参考值 格式错误', 1);			$data['invit_1'] = iv('post.invit_1', 'cny', '一代赠送比例 格式错误', 1);			$data['invit_2'] = iv('post.invit_2', 'cny', '二代赠送比例 格式错误', 1);			$data['invit_3'] = iv('post.invit_3', 'cny', '三代赠送比例 格式错误', 1);			$data['content'] = iv('post.content');			$data['sort'] = iv('post.sort', 'd', '排序格式错误', 1);			$data['strtime'] = iv('post.strtime', 'time', '开始时间格式错误', 1);			$data['sndtime'] = iv('post.sndtime', 'time', '结束时间格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table('cissue')->where(['id' => $id])->save($data);			} else {				$res = db::table('cissue')->add($data);			}			if ($res) {				ajax('操作成功', 1);			} else {				ajax('操作失败');			}		}	}	public function status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		show($builder->set_status($id, $type, 'cissue'));	}	public function log()	{		$builder = new builder("cissue_log");		$builder->title('充值记录', '这里是充值记录', '充值记录', '/cissue/log')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '禁用', '2' => '启用'], 'select')->search('field', ['name' => '认购名称', 'coinname_c_coin_c_name_c_title' => '认购币种', 'userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/edit/id/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('name', '认购名称', 'text')->key('coinname', '认购币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'coinname', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'coinname', 'color' => '',]])->key('buycoin', '认购币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'buycoin', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'buycoin', 'color' => '',]])->key('type', '付款类型', 'text')->key('info', '付款信息', 'text')->key('price', '认购价格', 'text')->key('num', '认购数量', 'text')->key('mum', '认购总额', 'text')->key('jd', '已解冻次数', 'text')->key('ci', '解冻总数', 'text')->key('jian', '解冻间隔', 'text')->key('addtime', '认购时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:#DA9151;">未付款</span>', 1 => '<span style="color:#3498db;">审核中</span>', 2 => '系统处理中', '3' => '认购成功', 4 => '解冻成功', 5 => '订单已取消', 6 => '状态异常'])->key("ext", '操作', 'link', [['type' => 'button2', 'url' => '/cissue/sure/id/###', 'title' => '确认到账', 'field' => 'id', 'color' => '', 'ajax' => 'get', 'exts' => ["status" => [1]],], ['type' => 'button2', 'url' => '/cissue/cancel/id/###', 'title' => '取消订单', 'field' => 'id', 'color' => '', 'ajax' => 'get', 'exts' => ["status" => [0, 1]],]])->lists();	}	public function sure()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = iv('get.id', 'd', '参数错误');		$issue_log = db::table('cissue_log')->where(['id' => $id])->find();		if ($issue_log['status'] != 1) {			ajax('当前订单状态错误', 1);		}		$res = db::table('cissue_log')->where(['id' => $id])->save(['status' => 2]);		if ($res) {			ajax('操作成功', 1);		} else {			ajax('操作失败');		}	}	public function cancel()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = iv('get.id', 'd', '参数错误');		$issue_log = db::table('cissue_log')->where(['id' => $id])->find();		if ($issue_log['status'] != 1 && $issue_log['status'] != 0) {			ajax('当前订单状态错误');		}		$res = db::table('cissue_log')->where(['id' => $id])->save(['status' => 5]);		if ($res) {			ajax('操作成功', 1);		} else {			ajax('操作失败');		}	}	public function invit()	{		$builder = new builder("cissue_invit");		$builder->title('认购赠送', '这里是认购赠送', '认购赠送', '/cissue/invit')->search('addtime_str', '开始时间', 'time')->search('addtime_end', '结束时间', 'time')->search('order', ['id_desc' => 'ID降序', 'id_asc' => 'ID升序', 'sort_desc' => '索引降序', 'sort_asc' => '索引升序', 'addtime_desc' => '时间降序', 'addtime_asc' => '时间升序',], 'select')->search('status', ['0' => '全部状态', '1' => '已申请', '2' => '提现成功', '3' => '已撤销', '4' => '正在处理'], 'select')->search('field', ['userid_c_user_c_id_c_username' => '用户名',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('invit', '推荐人', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'invit', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('type', '奖励类型', 'text')->key('name', '奖励说明', 'text')->key('num', '充值金额', 'text')->key('fee', '到账数量', 'text')->key('feecoin', '到账币种', 'link', [['type' => 'button', 'url' => '/coin/index/field/name/name/###', 'title' => ['from_id' => 'feecoin', 'table' => 'coin', 'to_id' => 'name', 'title' => 'title'], 'field' => 'feecoin', 'color' => '',]])->key('addtime', '操作时间', 'time')->lists();	}}