<?phpnamespace admin;use Move\db;use Move\config;use Move\cache;class sweike extends admin{	public function __construct()	{		parent::__construct();		if (!$this->is_game('sweike')) {			ajax('这个应用你没有购买');		}	}	public function index()	{		$builder = new builder("sweike");		$builder->title('威客管理', '这里是威客管理', '威客列表', '/sweike/index')->button('add', '添加', '/sweike/edit')->button('no', '禁用', '/sweike/status/type/0')->button('off', '启用', '/sweike/status/type/1')->button('del', '删除', '/sweike/status/type/-1')->search('field', ['userid' => '发布人', 'title' => '标题', 'content' => '内容',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('type', '类型', 'link', [['type' => 'button', 'url' => '/sweike/type/field/id/name/###', 'title' => ['from_id' => 'type', 'table' => 'sweike_type', 'to_id' => 'id', 'title' => 'type'], 'field' => 'type', 'color' => '',]])->key('title', '标题', 'text')->key('step', '进度', 'select', [1 => '<span style="color:	#3498db;">新发布</span>', 2 => '<span style="color:#3498db;">进行中</span>', 3 => '<span style="color:#FF0000;">已结束</span>', 4 => '<span style="color:#FF0000;">已关闭</span>'])->key('price', '价格', 'text')->key('price_type', '奖励类型', 'text')->key('tj', '是否推荐', 'select', [0 => "否", 1 => "是"])->key('num', '投稿数', 'text')->key('addtime', '发布时间', 'time')->key('endtime', '结束时间', 'time')->key('adress', '投稿地址', 'text')->key('fee', '手续费%', 'text')->key('status', '状态', 'select', [0 => '<span style="color:	#FF0000;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/sweike/edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',]])->lists();	}	public function edit()	{		if (empty($_POST)) {			$id = input('get.id');			$typearr = [];			$top_list = db::table("sweike_type")->where(["status" => 1, "pid" => 0])->order("sort asc , id desc")->select();			if ($top_list) {				foreach ($top_list as $k => $v) {					$top_list[$k]['pid_list'] = db::table("sweike_type")->where(["status" => 1, "pid" => $v['id']])->order("sort asc , id desc")->select();					$typearr[$v["id"]] = "--" . $v["type"];					if ($top_list[$k]['pid_list']) {						foreach ($top_list[$k]['pid_list'] as $kk => $vv) {							$top_list[$k]['pid_list'][$kk]['pid_list'] = db::table("sweike_type")->where(["status" => 1, "pid" => $vv['id']])->order("sort asc , id desc")->select();							$typearr[$vv["id"]] = "----" . $vv["type"];							if ($top_list[$k]['pid_list'][$kk]['pid_list']) {								foreach ($top_list[$k]['pid_list'][$kk]['pid_list'] as $kkk => $vvv) {									$top_list[$k]['pid_list'][$kk]['pid_list'][$kkk]['pid_list'] = db::table("sweike_type")->where(["status" => 1, "pid" => $vvv['id']])->order("sort asc , id desc")->select();									$typearr[$vvv["id"]] = "------" . $vvv["type"];								}							}						}					}				}			}			$builder = new builder("sweike", ["id" => $id], "edit");			$builder->title(($id ? '编辑威客' : '添加威客'), ($id ? '这里是编辑威客' : '这里是添加威客'), '威客管理', '/sweike/index')->key('id', '编号', 'readonly', '', '数据编号')->key('id', '编号', 'hidden', '', '数据编号')->key('userid', '发布人ID', 'text', '', '发布人ID(系统管理员为0)')->key('title', '标题', 'text', '', '威客标题(全部格式)')->key('type', '类型', 'select', $typearr, '')->key('price', '价格', 'text', '', '威客酬劳(小数格式)')->key('price_type', '奖励币种', 'select', 'coin_c_name_c_title', '威客奖励币种')->key('tj', '推荐', 'select', [0 => '否', 1 => '是'], '是否推荐')->key('addtime', '添加时间', 'time', '', '添加时间(只能时间)')->key('endtime', '结束时间', 'time', '', '任务结束时间 (只能时间)')->key('step', '进度', 'select', [1 => '新发布'], '威客进度(默认值,程序根据时间自动判断)')->key('adress', '投稿地址', 'text', '', ' 线下投稿地址(全部格式)')->key('fee', '手续费', 'text', '', ' %手续费(小数)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->key('content', '内容及要求', 'text', '', '请输入威客内容和要求(全部格式)')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['userid'] = iv('post.userid', 'd', '发布人ID格式错误', 1);			$data['title'] = iv('post.title', 'a', '威客标题 格式错误', 1);			$data["step"] = iv('post.step', 'd', '威客进度 格式错误', 1);			$data['type'] = iv('post.type', 'd', '威客类型 格式错误');			$data['price'] = iv('post.price', 'double', '威客价格 格式错误', 1);			$data['price_type'] = iv('post.price_type', 'w', '威客币种 格式错误', 1);			$data['tj'] = iv('post.tj', 'd', '推荐格式错误', 1);			$data['addtime'] = iv('post.addtime', 'time', '开始时间格式错误', 1);			$data['endtime'] = iv('post.endtime', 'time', '结束时间格式错误', 1);			$data['adress'] = iv('post.adress', "a", '投稿地址格式错误', 1);			$data['fee'] = iv('post.fee', "double", '手续费格式错误', 1);			$data['content'] = iv('post.content', "a", '内容格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table("sweike")->where(["id" => $id])->save($data);			} else {				$res = db::table("sweike")->add($data);			}			if ($res) {				ajax('操作成功', 1, "/admin/sweike/index");			} else {				ajax('操作失败');			}		}	}	public function status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		show($builder->set_status($id, $type, 'sweike'));	}	public function type()	{		$builder = new builder("sweike_type");		$builder->title('威客类型管理', '这里是威客类型管理', '威客类型列表', '/sweike/type')->button('add', '添加', '/sweike/type_edit')->button('no', '禁用', '/sweike/type_status/type/0')->button('off', '启用', '/sweike/type_status/type/1')->button('del', '删除', '/sweike/type_status/type/-1')->key('id', 'ID', 'text')->key('type', '类型名称', 'text')->key('pid', '上级', 'link', [['type' => 'button', 'url' => '/sweike/type/field/id/name/###', 'title' => ['from_id' => 'pid', 'table' => 'sweike_type', 'to_id' => 'id', 'title' => 'type'], 'field' => 'pid', 'color' => '',]])->key('addtime', '修改时间', 'time')->key('status', '状态', 'select', [0 => '<span style="color:	#FF0000;">禁用</span>', 1 => '<span style="color:#3498db;">启用</span>'])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/sweike/type_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',]])->lists();	}	public function type_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$typearr = [];			$typearr["0"] = "--顶级菜单--";			$top_list = db::table("sweike_type")->where(["status" => 1, "pid" => 0])->order("sort asc , id desc")->select();			if ($top_list) {				foreach ($top_list as $k => $v) {					$top_list[$k]['pid_list'] = db::table("sweike_type")->where(["status" => 1, "pid" => $v['id']])->order("sort asc , id desc")->select();					$typearr[$v["id"]] = "--" . $v["type"];					if ($top_list[$k]['pid_list']) {						foreach ($top_list[$k]['pid_list'] as $kk => $vv) {							$top_list[$k]['pid_list'][$kk]['pid_list'] = db::table("sweike_type")->where(["status" => 1, "pid" => $vv['id']])->order("sort asc , id desc")->select();							$typearr[$vv["id"]] = "----" . $vv["type"];						}					}				}			}			$builder = new builder("sweike_type", ["id" => $id], "edit");			$builder->title(($id ? '编辑威客类型' : '添加威客类型'), ($id ? '这里是编辑威客类型' : '这里是添加威客类型'), '威客类型管理', '/sweike/type')->key('id', '编号', 'readonly', '', '类型编号')->key('id', '编号', 'hidden', '', '类型编号')->key('type', '威客类型', 'text', '', '定义威客类型(全部格式)')->key('pid', '上级标题', 'select', $typearr, '标题 (全部格式)')->key('addtime', '添加时间', 'time', '', '选择当前时间(时间格式)')->key('status', '状态', 'select', [0 => '禁用', 1 => '启用'], '')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['type'] = iv('post.type', 'a', '威客类型类型 格式错误');			$data['addtime'] = iv('post.addtime', 'time', '开始时间格式错误', 1);			$data['pid'] = iv('post.pid', 'd', '上级标题格式错误', 1);			$data['status'] = iv('post.status', 'd', '状态格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table("sweike_type")->where(["id" => $id])->save($data);			} else {				$res = db::table("sweike_type")->add($data);			}			if ($res) {				ajax('操作成功', 1, "/admin/sweike/type");			} else {				ajax('操作失败');			}		}	}	public function type_status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		$builder = new builder();		show($builder->set_status($id, $type, 'sweike_type'));	}	public function tender()	{		$builder = new builder("sweike_tender");		$builder->title('投标管理管理', '这里是投标管理管理', '投标管理列表', '/sweike/tender')->button('add', '添加', '/sweike/tender_edit')->button('no', '不中标', '/sweike/tender_status/type/0')->button('off', '中标', '/sweike/tender_status/type/1')->button('del', '删除', '/sweike/tender_status/type/-1')->search('field', ['weikeid' => '威客ID',], 'select')->search('name', '请输入查询内容', 'text')->key('id', 'ID', 'text')->key('weikeid', '威客ID', 'text')->key('userid', '用户名', 'link', [['type' => 'button', 'url' => '/user/index/field/id/name/###', 'title' => ['from_id' => 'userid', 'table' => 'user', 'to_id' => 'id', 'title' => 'username'], 'field' => 'userid', 'color' => '',]])->key('content', '	投标内容', 'text')->key('addtime', '投标时间', 'time')->key('price', '奖励', 'text')->key('price_type', '奖励币种', 'text')->key('status', '中标状态', 'select', [0 => '<span style="color:#FF0000;">未通过</span>', 1 => '<span style="color:	#32CD32;">恭喜你,中标!</span>', 2 => '<span style="color:#000000;">审核中</span>', 3 => "已支付 "])->key("ext", '操作', 'link', [['type' => 'button3', 'url' => '/sweike/tender_edit/id/###', 'title' => '编辑', 'field' => 'id', 'color' => '',], ['type' => 'button2', 'url' => '/sweike/pay/id/###', 'title' => '支付酬劳', 'field' => 'id', 'color' => '', 'ajax' => 'get', 'exts' => ["status" => [1]]]])->lists();	}	public function tender_edit()	{		if (empty($_POST)) {			$id = input('get.id');			$builder = new builder("sweike_tender", ["id" => $id], "edit");			$builder->title(($id ? '编辑投标管理' : '添加投标管理'), ($id ? '这里是编辑投标管理类型' : '这里是添加投标管理'), '投标管理', '/sweike/type')->key('id', '编号', 'readonly', '', '投标编号')->key('id', '编号', 'hidden', '', '投标编号')->key('weikeid', '威客编号', 'text', '', '威客编号')->key('userid', '投标人id', 'text', '', '投标人')->key('content', '投标内容', 'text', '', '投标内容')->key('addtime', '添加时间', 'time', '', '添加时间')->key('price', '奖励', 'text', '', '奖励')->key('price_type', '奖励币种', 'text', '', '奖励币种')->edit();		} else {			if (APP_DEMO) {				ajax('测试站暂时不能修改');			}			$data['weikeid'] = iv('post.weikeid', 'd', '威客类id 格式错误');			$data['userid'] = iv('post.userid', 'a', '用户名ID 格式错误');			$data['content'] = iv('post.content', 'a', '威客类型 格式错误');			$data['addtime'] = iv('post.addtime', 'time', '开始时间格式错误', 1);			$data['price'] = iv('post.price', 'text', '奖励格式错误', 1);			$data['price_type'] = iv('post.price_type', 'text', '奖励币种格式错误', 1);			$id = iv('post.id');			if ($id) {				$res = db::table("sweike_tender")->where(["id" => $id])->save($data);			} else {				$res = db::table('sweike_tender')->add($data);			}			if ($res) {				ajax('操作成功', 1, "/admin/sweike/tender");			} else {				ajax('操作失败');			}		}	}	public function tender_status()	{		if (APP_DEMO) {			ajax('测试站暂时不能修改');		}		$id = input('post.id');		$type = input('get.type');		if ($type == 1) {			db::table("sweike_tender")->where(["id" => $id])->save(["endtime" => time()]);		}		$builder = new builder();		show($builder->set_status($id, $type, 'sweike_tender'));	}	public function pay()	{		$id = iv("get.id" . "d", "参数错误");		$res = md('sweike')->pay_admin($id);		if (isset($res[1]) && $res[1]) {			ajax($res[0], 1);		} else {			ajax($res[0]);		}	}}